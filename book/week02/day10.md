# ç¬¬10å¤©ï¼šMACåœ°å€å’ŒARPåè®®

> "IPåœ°å€æ˜¯é€»è¾‘åœ°å€ï¼ŒMACåœ°å€æ˜¯ç‰©ç†åœ°å€ã€‚"

## ğŸ“š ä»Šæ—¥ç›®æ ‡

- ç†è§£MACåœ°å€çš„æ¦‚å¿µå’Œæ ¼å¼
- æŒæ¡MACåœ°å€å’ŒIPåœ°å€çš„åŒºåˆ«
- ç†è§£ARPåè®®çš„å·¥ä½œåŸç†
- å­¦ä¼šæŸ¥çœ‹å’Œç®¡ç†ARPç¼“å­˜
- ç¼–å†™ARPæ‰«æå·¥å…·

## ğŸ¯ ä»€ä¹ˆæ˜¯MACåœ°å€ï¼Ÿ

### ç”Ÿæ´»ä¸­çš„ä¾‹å­

```
MACåœ°å€ = èº«ä»½è¯å·

èº«ä»½è¯å·ï¼šç»ˆèº«ä¸å˜ï¼Œå”¯ä¸€æ ‡è¯†ä¸€ä¸ªäºº
MACåœ°å€ï¼šå‡ºå‚å›ºåŒ–ï¼Œå”¯ä¸€æ ‡è¯†ä¸€å—ç½‘å¡

IPåœ°å€ = å®¶åº­ä½å€

å®¶åº­ä½å€ï¼šå¯ä»¥æ¬å®¶æ›´æ¢
IPåœ°å€ï¼šå¯ä»¥æ›´æ¢ç½‘ç»œè€Œæ”¹å˜
```

**MACåœ°å€**ï¼ˆMedia Access Control Addressï¼Œåª’ä½“è®¿é—®æ§åˆ¶åœ°å€ï¼‰æ˜¯ç½‘å¡ï¼ˆç½‘ç»œæ¥å£å¡ï¼‰çš„ç‰©ç†åœ°å€ï¼Œç”¨äºåœ¨æ•°æ®é“¾è·¯å±‚æ ‡è¯†ç½‘ç»œè®¾å¤‡ã€‚

### MACåœ°å€çš„ç‰¹ç‚¹

1. **å…¨çƒå”¯ä¸€**ï¼šç†è®ºä¸Šä¸–ç•Œä¸Šæ²¡æœ‰ä¸¤å—ç½‘å¡æœ‰ç›¸åŒçš„MACåœ°å€
2. **å›ºåŒ–åœ¨ç¡¬ä»¶**ï¼šå‡ºå‚æ—¶å†™å…¥ROMï¼Œä¸€èˆ¬ä¸å¯æ›´æ”¹
3. **48ä½ï¼ˆ6å­—èŠ‚ï¼‰**ï¼šé€šå¸¸ç”¨12ä½åå…­è¿›åˆ¶æ•°è¡¨ç¤º
4. **æ•°æ®é“¾è·¯å±‚**ï¼šå·¥ä½œåœ¨OSIæ¨¡å‹çš„ç¬¬2å±‚

## ğŸ“Š MACåœ°å€æ ¼å¼

### æ ‡å‡†æ ¼å¼

```
å¸¸è§è¡¨ç¤ºæ–¹æ³•ï¼š

1. å†’å·åˆ†éš”ï¼ˆLinux/Unixï¼‰
   AA:BB:CC:DD:EE:FF

2. æ¨ªçº¿åˆ†éš”ï¼ˆWindowsï¼‰
   AA-BB-CC-DD-EE-FF

3. ç‚¹åˆ†éš”ï¼ˆCiscoï¼‰
   AABB.CCDD.EEFF

4. è¿ç»­ï¼ˆæ— åˆ†éš”ç¬¦ï¼‰
   AABBCCDDEEFF

éƒ½æ˜¯åŒä¸€ä¸ªMACåœ°å€ï¼
```

### MACåœ°å€ç»“æ„

```
MACåœ°å€åˆ†ä¸ºä¸¤éƒ¨åˆ†ï¼š

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  OUI (24ä½)     â”‚  è®¾å¤‡æ ‡è¯†(24ä½) â”‚
â”‚  å‚å•†æ ‡è¯†       â”‚  åºåˆ—å·         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
  AA:BB:CC         DD:EE:FF

OUIï¼ˆOrganizationally Unique Identifierï¼‰ï¼š
- å‰3ä¸ªå­—èŠ‚ï¼ˆ24ä½ï¼‰
- IEEEåˆ†é…ç»™å‚å•†çš„å”¯ä¸€æ ‡è¯†
- ä¾‹å¦‚ï¼š
  - 00:50:56 â†’ VMwareè™šæ‹Ÿç½‘å¡
  - 00:1C:42 â†’ Parallelsè™šæ‹Ÿç½‘å¡
  - DC:A6:32 â†’ Raspberry Pi
  - 3C:A9:F4 â†’ å°ç±³è®¾å¤‡

è®¾å¤‡æ ‡è¯†ï¼š
- å3ä¸ªå­—èŠ‚ï¼ˆ24ä½ï¼‰
- å‚å•†è‡ªè¡Œåˆ†é…çš„åºåˆ—å·
- ç†è®ºä¸Šå¯äº§ç”Ÿ 2^24 = 16,777,216 ä¸ªåœ°å€
```

### ç‰¹æ®ŠMACåœ°å€

```
1. å¹¿æ’­MACåœ°å€
   FF:FF:FF:FF:FF:FF
   ç”¨äºå‘å±€åŸŸç½‘å†…æ‰€æœ‰è®¾å¤‡å‘é€æ•°æ®

2. ç»„æ’­MACåœ°å€
   ç¬¬ä¸€ä¸ªå­—èŠ‚çš„æœ€ä½ä½ä¸º1
   ä¾‹å¦‚ï¼š01:00:5E:XX:XX:XXï¼ˆIPv4ç»„æ’­ï¼‰

3. å•æ’­MACåœ°å€
   ç¬¬ä¸€ä¸ªå­—èŠ‚çš„æœ€ä½ä½ä¸º0
   æ™®é€šçš„è®¾å¤‡åœ°å€
```

## ğŸ” MACåœ°å€ vs IPåœ°å€

### å¯¹æ¯”è¡¨

| ç‰¹æ€§ | MACåœ°å€ | IPåœ°å€ |
|------|---------|--------|
| å±‚æ¬¡ | æ•°æ®é“¾è·¯å±‚ï¼ˆç¬¬2å±‚ï¼‰ | ç½‘ç»œå±‚ï¼ˆç¬¬3å±‚ï¼‰ |
| é•¿åº¦ | 48ä½ï¼ˆ6å­—èŠ‚ï¼‰ | 32ä½ï¼ˆIPv4ï¼‰æˆ–128ä½ï¼ˆIPv6ï¼‰ |
| è¡¨ç¤º | åå…­è¿›åˆ¶ | åè¿›åˆ¶ï¼ˆç‚¹åˆ†ï¼‰ |
| åˆ†é… | å‚å•†åˆ†é…ï¼Œå›ºåŒ–åœ¨ç¡¬ä»¶ | ç½‘ç»œç®¡ç†å‘˜æˆ–DHCPåˆ†é… |
| å”¯ä¸€æ€§ | å…¨çƒå”¯ä¸€ | ç½‘ç»œå†…å”¯ä¸€ |
| å¯å˜æ€§ | ç†è®ºä¸Šä¸å¯å˜ | å¯ä»¥æ›´æ¢ |
| ä½œç”¨èŒƒå›´ | å±€åŸŸç½‘å†… | å¯è·¨è¶Šå¤šä¸ªç½‘ç»œ |
| è·¯ç”± | ä¸èƒ½è·¯ç”± | å¯ä»¥è·¯ç”± |

### ä¸ºä»€ä¹ˆéœ€è¦ä¸¤ä¸ªåœ°å€ï¼Ÿ

```
ç±»æ¯”ï¼šå¿«é€’ç³»ç»Ÿ

MACåœ°å€ = æ¥¼å±‚å’Œæˆ¿é—´å·
- åœ¨ä¸€æ ‹æ¥¼å†…æ‰¾åˆ°å…·ä½“æˆ¿é—´
- åªåœ¨æœ¬æ¥¼æœ‰æ•ˆ
- å›ºå®šä¸å˜

IPåœ°å€ = åŸå¸‚å’Œè¡—é“åœ°å€
- è·¨åŸå¸‚å¯»æ‰¾ç›®æ ‡
- å¯ä»¥æ¬å®¶ï¼ˆæ›´æ¢ç½‘ç»œï¼‰
- å¯å˜

è¿‡ç¨‹ï¼š
1. å¿«é€’å…ˆé€šè¿‡åŸå¸‚åœ°å€æ‰¾åˆ°ç›®æ ‡åŸå¸‚ï¼ˆIPè·¯ç”±ï¼‰
2. åˆ°è¾¾åé€šè¿‡æ¥¼å±‚æˆ¿é—´å·æ‰¾åˆ°å…·ä½“ä½ç½®ï¼ˆMACå¯»å€ï¼‰
```

### æ•°æ®ä¼ è¾“è¿‡ç¨‹

```
åŒ—äº¬çš„ç”µè„‘A â†’ ä¸Šæµ·çš„ç”µè„‘B

1. åº”ç”¨å±‚ï¼šç”Ÿæˆæ•°æ®
2. ä¼ è¾“å±‚ï¼šæ·»åŠ ç«¯å£å·
3. ç½‘ç»œå±‚ï¼šæ·»åŠ IPåœ°å€
   æºIPï¼šåŒ—äº¬Açš„IP
   ç›®æ ‡IPï¼šä¸Šæµ·Bçš„IP
4. æ•°æ®é“¾è·¯å±‚ï¼šæ·»åŠ MACåœ°å€
   æºMACï¼šå½“å‰è·¯ç”±å™¨çš„MAC
   ç›®æ ‡MACï¼šä¸‹ä¸€è·³è·¯ç”±å™¨çš„MAC

é‡ç‚¹ï¼š
- IPåœ°å€ä»å¤´åˆ°å°¾ä¸å˜ï¼ˆåŒ—äº¬A â†’ ä¸Šæµ·Bï¼‰
- MACåœ°å€æ¯ä¸€è·³éƒ½ä¼šå˜åŒ–ï¼ˆæ¯æ®µé“¾è·¯ä½¿ç”¨ä¸åŒçš„MACï¼‰
```

## ğŸ“¡ ARPåè®®

### ä»€ä¹ˆæ˜¯ARPï¼Ÿ

**ARP**ï¼ˆAddress Resolution Protocolï¼Œåœ°å€è§£æåè®®ï¼‰ç”¨äºå°†IPåœ°å€è½¬æ¢ä¸ºMACåœ°å€ã€‚

```
é—®é¢˜ï¼šæˆ‘çŸ¥é“ç›®æ ‡çš„IPåœ°å€ï¼Œä½†è¦å‘é€æ•°æ®éœ€è¦MACåœ°å€

ARPçš„ä½œç”¨ï¼š
IPåœ°å€ï¼ˆ192.168.1.100ï¼‰ â†’ ARPæŸ¥è¯¢ â†’ MACåœ°å€ï¼ˆAA:BB:CC:DD:EE:FFï¼‰
```

### ARPå·¥ä½œåŸç†

#### åœºæ™¯ï¼šä¸»æœºAï¼ˆ192.168.1.10ï¼‰è¦å‘é€æ•°æ®ç»™ä¸»æœºBï¼ˆ192.168.1.20ï¼‰

```
æ­¥éª¤1ï¼šæ£€æŸ¥ARPç¼“å­˜
ä¸»æœºAé¦–å…ˆæŸ¥çœ‹æœ¬åœ°ARPç¼“å­˜è¡¨
- å¦‚æœæœ‰192.168.1.20çš„MACåœ°å€ â†’ ç›´æ¥ä½¿ç”¨
- å¦‚æœæ²¡æœ‰ â†’ å‘é€ARPè¯·æ±‚

æ­¥éª¤2ï¼šå‘é€ARPè¯·æ±‚ï¼ˆå¹¿æ’­ï¼‰
ä¸»æœºAå‘é€å¹¿æ’­åŒ…ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ è°æ˜¯192.168.1.20ï¼Ÿ                  â”‚
â”‚ è¯·å‘Šè¯‰192.168.1.10                  â”‚
â”‚ æˆ‘çš„MACæ˜¯AA:AA:AA:AA:AA:AA          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
ç›®æ ‡MACï¼šFF:FF:FF:FF:FF:FFï¼ˆå¹¿æ’­ï¼‰

æ­¥éª¤3ï¼šæ‰€æœ‰ä¸»æœºæ¥æ”¶
å±€åŸŸç½‘å†…æ‰€æœ‰ä¸»æœºéƒ½æ”¶åˆ°è¿™ä¸ªå¹¿æ’­åŒ…
- ä¸»æœºBï¼šè¿™æ˜¯é—®æˆ‘çš„ï¼
- å…¶ä»–ä¸»æœºï¼šä¸æ˜¯é—®æˆ‘çš„ï¼Œä¸¢å¼ƒ

æ­¥éª¤4ï¼šä¸»æœºBå‘é€ARPå“åº”ï¼ˆå•æ’­ï¼‰
ä¸»æœºBå›å¤ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ æˆ‘æ˜¯192.168.1.20                    â”‚
â”‚ æˆ‘çš„MACæ˜¯BB:BB:BB:BB:BB:BB          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
ç›®æ ‡MACï¼šAA:AA:AA:AA:AA:AAï¼ˆå•æ’­ç»™Aï¼‰

æ­¥éª¤5ï¼šä¸»æœºAæ›´æ–°ARPç¼“å­˜
ä¸»æœºAè®°å½•ï¼š
192.168.1.20 â†’ BB:BB:BB:BB:BB:BB

æ­¥éª¤6ï¼šå¼€å§‹é€šä¿¡
ç°åœ¨ä¸»æœºAçŸ¥é“äº†ä¸»æœºBçš„MACåœ°å€ï¼Œå¯ä»¥å‘é€æ•°æ®äº†
```

### ARPæŠ¥æ–‡æ ¼å¼

```
ARPè¯·æ±‚/å“åº”æŠ¥æ–‡ï¼š

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ç¡¬ä»¶ç±»å‹ï¼ˆ2å­—èŠ‚ï¼‰                  â”‚ 1 = ä»¥å¤ªç½‘
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ åè®®ç±»å‹ï¼ˆ2å­—èŠ‚ï¼‰                  â”‚ 0x0800 = IP
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ç¡¬ä»¶åœ°å€é•¿åº¦ï¼ˆ1å­—èŠ‚ï¼‰              â”‚ 6 = MACåœ°å€6å­—èŠ‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ åè®®åœ°å€é•¿åº¦ï¼ˆ1å­—èŠ‚ï¼‰              â”‚ 4 = IPåœ°å€4å­—èŠ‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ æ“ä½œç ï¼ˆ2å­—èŠ‚ï¼‰                    â”‚ 1=è¯·æ±‚ï¼Œ2=å“åº”
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ å‘é€æ–¹MACåœ°å€ï¼ˆ6å­—èŠ‚ï¼‰             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ å‘é€æ–¹IPåœ°å€ï¼ˆ4å­—èŠ‚ï¼‰              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ç›®æ ‡MACåœ°å€ï¼ˆ6å­—èŠ‚ï¼‰               â”‚ è¯·æ±‚æ—¶ä¸ºå…¨0
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ç›®æ ‡IPåœ°å€ï¼ˆ4å­—èŠ‚ï¼‰                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ARPç¼“å­˜

ä¸ºäº†æé«˜æ•ˆç‡ï¼Œç³»ç»Ÿä¼šç¼“å­˜ARPè§£æçš„ç»“æœã€‚

```
ARPç¼“å­˜è¡¨ç¤ºä¾‹ï¼š

IPåœ°å€           MACåœ°å€              ç±»å‹     è¿‡æœŸæ—¶é—´
192.168.1.1     AA:BB:CC:DD:EE:FF    åŠ¨æ€     120ç§’
192.168.1.20    11:22:33:44:55:66    åŠ¨æ€     120ç§’
192.168.1.100   FF:EE:DD:CC:BB:AA    é™æ€     æ°¸ä¹…

ç±»å‹ï¼š
- åŠ¨æ€ï¼šé€šè¿‡ARPåè®®è‡ªåŠ¨å­¦ä¹ ï¼Œæœ‰è¿‡æœŸæ—¶é—´
- é™æ€ï¼šæ‰‹åŠ¨é…ç½®ï¼Œæ°¸ä¹…æœ‰æ•ˆ
```

### æŸ¥çœ‹ARPç¼“å­˜

```bash
# Windows
arp -a

# Linux/Mac
arp -n

# æŸ¥çœ‹ç‰¹å®šIPçš„MAC
arp -n 192.168.1.1

# æ¸…ç©ºARPç¼“å­˜ï¼ˆéœ€è¦ç®¡ç†å‘˜æƒé™ï¼‰
# Windows
arp -d

# Linux
sudo ip -s -s neigh flush all

# Mac
sudo arp -d -a
```

## ğŸ”§ å®æˆ˜é¡¹ç›®ï¼šARPæ‰«æå·¥å…·

è®©æˆ‘ä»¬ç¼–å†™ä¸€ä¸ªARPæ‰«æå·¥å…·ï¼Œç”¨äºå‘ç°å±€åŸŸç½‘å†…çš„æ‰€æœ‰è®¾å¤‡ï¼

### ä»£ç å®ç°

```python
# day10_arp_scanner.py
# åŠŸèƒ½ï¼šARPæ‰«æå·¥å…·

import socket
import struct
import time
from concurrent.futures import ThreadPoolExecutor

class ARPScanner:
    """ARPæ‰«æå™¨"""

    def __init__(self):
        # OUIæ•°æ®åº“ï¼ˆéƒ¨åˆ†å¸¸è§å‚å•†ï¼‰
        self.oui_database = {
            '00:50:56': 'VMware',
            '00:0C:29': 'VMware',
            '00:1C:42': 'Parallels',
            '08:00:27': 'VirtualBox',
            'DC:A6:32': 'Raspberry Pi',
            '3C:A9:F4': 'å°ç±³',
            '28:6C:07': 'å°ç±³',
            'F8:A4:5F': 'åä¸º',
            '00:E0:4C': 'åä¸º',
            'AC:DE:48': 'Apple',
            '00:03:93': 'Apple',
        }

    def get_mac_vendor(self, mac):
        """
        æ ¹æ®MACåœ°å€è·å–å‚å•†ä¿¡æ¯

        å‚æ•°ï¼š
            mac: MACåœ°å€å­—ç¬¦ä¸²

        è¿”å›ï¼š
            å‚å•†åç§°
        """
        # æå–OUIï¼ˆå‰3ä¸ªå­—èŠ‚ï¼‰
        oui = ':'.join(mac.split(':')[:3]).upper()

        return self.oui_database.get(oui, 'æœªçŸ¥å‚å•†')

    def get_local_ip(self):
        """
        è·å–æœ¬æœºIPåœ°å€
        """
        try:
            sock = socket.socket(socket.AF_INET, socket.SOCK_DGRAM)
            sock.connect(("8.8.8.8", 80))
            local_ip = sock.getsockname()[0]
            sock.close()
            return local_ip
        except:
            return None

    def get_mac_address(self, ip):
        """
        é€šè¿‡ARPè·å–æŒ‡å®šIPçš„MACåœ°å€

        å‚æ•°ï¼š
            ip: ç›®æ ‡IPåœ°å€

        è¿”å›ï¼š
            MACåœ°å€å­—ç¬¦ä¸²ï¼Œå¦‚æœå¤±è´¥è¿”å›None

        å·¥ä½œåŸç†ï¼š
            å‘é€ARPè¯·æ±‚ï¼Œç­‰å¾…å“åº”
        """
        try:
            # åœ¨Windowsä¸Šä½¿ç”¨arpå‘½ä»¤
            import subprocess
            import platform

            system = platform.system()

            if system == 'Windows':
                # Windows: arp -a IP
                result = subprocess.check_output(
                    f'arp -a {ip}',
                    shell=True,
                    stderr=subprocess.DEVNULL
                ).decode('gbk', errors='ignore')

                # è§£æè¾“å‡º
                for line in result.split('\n'):
                    if ip in line:
                        parts = line.split()
                        if len(parts) >= 2:
                            mac = parts[1].replace('-', ':')
                            return mac

            else:
                # Linux/Mac: arp -n IP
                result = subprocess.check_output(
                    f'arp -n {ip}',
                    shell=True,
                    stderr=subprocess.DEVNULL
                ).decode('utf-8', errors='ignore')

                for line in result.split('\n'):
                    if ip in line:
                        parts = line.split()
                        if len(parts) >= 3:
                            return parts[2]

        except:
            pass

        return None

    def ping_and_get_mac(self, ip):
        """
        å…ˆpingä¸€ä¸‹IPï¼ˆè§¦å‘ARPï¼‰ï¼Œç„¶åè·å–MACåœ°å€

        å‚æ•°ï¼š
            ip: ç›®æ ‡IPåœ°å€

        è¿”å›ï¼š
            (ip, mac, vendor) å…ƒç»„ï¼Œå¤±è´¥è¿”å›None
        """
        try:
            import subprocess
            import platform

            system = platform.system()

            # å…ˆpingä¸€ä¸‹ï¼Œè§¦å‘ARP
            if system == 'Windows':
                ping_cmd = f'ping -n 1 -w 500 {ip}'
            else:
                ping_cmd = f'ping -c 1 -W 1 {ip}'

            subprocess.run(
                ping_cmd,
                shell=True,
                stdout=subprocess.DEVNULL,
                stderr=subprocess.DEVNULL,
                timeout=2
            )

            # è·å–MACåœ°å€
            mac = self.get_mac_address(ip)

            if mac and mac != '(incomplete)' and 'ff:ff:ff:ff:ff:ff' not in mac.lower():
                vendor = self.get_mac_vendor(mac)
                return (ip, mac, vendor)

        except:
            pass

        return None

    def scan_network(self, network, max_workers=50):
        """
        æ‰«ææ•´ä¸ªç½‘ç»œ

        å‚æ•°ï¼š
            network: ç½‘ç»œåœ°å€ï¼ˆå¦‚ "192.168.1.0/24"ï¼‰
            max_workers: æœ€å¤§çº¿ç¨‹æ•°

        è¿”å›ï¼š
            å‘ç°çš„è®¾å¤‡åˆ—è¡¨
        """
        import ipaddress

        print(f"ğŸ” å¼€å§‹æ‰«æç½‘ç»œ: {network}")
        print(f"â³ è¯·ç¨å€™...\n")

        # è§£æç½‘ç»œ
        net = ipaddress.ip_network(network, strict=False)
        total = net.num_addresses - 2

        devices = []
        scanned = 0

        # ä½¿ç”¨çº¿ç¨‹æ± å¹¶å‘æ‰«æ
        with ThreadPoolExecutor(max_workers=max_workers) as executor:
            futures = {
                executor.submit(self.ping_and_get_mac, str(ip)): ip
                for ip in net.hosts()
            }

            from concurrent.futures import as_completed

            for future in as_completed(futures):
                scanned += 1
                result = future.result()

                if result:
                    devices.append(result)
                    ip, mac, vendor = result
                    print(f"âœ… {ip:<15} {mac:<17} {vendor}")

                # æ˜¾ç¤ºè¿›åº¦
                if scanned % 20 == 0:
                    progress = (scanned / total) * 100
                    print(f"   è¿›åº¦: {progress:.1f}% ({scanned}/{total})", end='\r')

        return devices

    def display_results(self, devices):
        """
        æ˜¾ç¤ºæ‰«æç»“æœ

        å‚æ•°ï¼š
            devices: è®¾å¤‡åˆ—è¡¨
        """
        print("\n" + "=" * 70)
        print(f"æ‰«æå®Œæˆï¼å…±å‘ç° {len(devices)} å°è®¾å¤‡")
        print("=" * 70)

        if devices:
            print(f"\n{'IPåœ°å€':<15} {'MACåœ°å€':<17} {'å‚å•†'}")
            print("-" * 70)

            for ip, mac, vendor in sorted(devices):
                print(f"{ip:<15} {mac:<17} {vendor}")

        print("\n" + "=" * 70)

def view_arp_cache():
    """
    æŸ¥çœ‹ç³»ç»ŸARPç¼“å­˜
    """
    import subprocess
    import platform

    print("=" * 70)
    print("ç³»ç»ŸARPç¼“å­˜è¡¨".center(70))
    print("=" * 70)
    print()

    try:
        system = platform.system()

        if system == 'Windows':
            result = subprocess.check_output('arp -a', shell=True).decode('gbk', errors='ignore')
        else:
            result = subprocess.check_output('arp -n', shell=True).decode('utf-8', errors='ignore')

        print(result)

    except Exception as e:
        print(f"âŒ æ— æ³•è·å–ARPç¼“å­˜: {e}")

    print("=" * 70)

def main():
    """
    ä¸»å‡½æ•°
    """
    scanner = ARPScanner()

    print("=" * 70)
    print("ARPæ‰«æå·¥å…·".center(70))
    print("=" * 70)
    print()

    # è·å–æœ¬æœºIP
    local_ip = scanner.get_local_ip()
    if local_ip:
        print(f"ğŸ’» æœ¬æœºIP: {local_ip}")

        # æ¨æ–­ç½‘ç»œ
        ip_parts = local_ip.split('.')
        network = f"{ip_parts[0]}.{ip_parts[1]}.{ip_parts[2]}.0/24"
        print(f"ğŸŒ æ¨æ–­ç½‘ç»œ: {network}")
    else:
        network = "192.168.1.0/24"
        print(f"ğŸŒ ä½¿ç”¨é»˜è®¤ç½‘ç»œ: {network}")

    print()
    print("è¯·é€‰æ‹©åŠŸèƒ½:")
    print("1. æ‰«æå±€åŸŸç½‘è®¾å¤‡ï¼ˆæ¨èï¼‰")
    print("2. æ‰«æè‡ªå®šä¹‰ç½‘ç»œ")
    print("3. æŸ¥çœ‹ARPç¼“å­˜è¡¨")
    print("0. é€€å‡º")

    choice = input("\nè¯·è¾“å…¥é€‰é¡¹: ").strip()

    if choice == '1':
        devices = scanner.scan_network(network)
        scanner.display_results(devices)

    elif choice == '2':
        custom_network = input("\nè¯·è¾“å…¥ç½‘ç»œåœ°å€ï¼ˆå¦‚192.168.1.0/24ï¼‰: ").strip()
        if custom_network:
            devices = scanner.scan_network(custom_network)
            scanner.display_results(devices)

    elif choice == '3':
        view_arp_cache()

    elif choice == '0':
        print("\nå†è§ï¼")

if __name__ == "__main__":
    main()
```

### è¿è¡Œç¨‹åº

```bash
python code/day10/day10_arp_scanner.py
```

## ğŸ” ä»£ç è¯¦è§£

### 1. ARPå·¥ä½œæµç¨‹

```python
# 1. Pingè§¦å‘ARP
subprocess.run(f'ping -c 1 {ip}', ...)

# 2. ç³»ç»Ÿè‡ªåŠ¨å‘é€ARPè¯·æ±‚
# 3. ç›®æ ‡ä¸»æœºå“åº”
# 4. ç³»ç»Ÿç¼“å­˜ARPè¡¨é¡¹

# 5. è¯»å–ARPç¼“å­˜
subprocess.check_output('arp -n', ...)
```

### 2. å¹¶å‘æ‰«ææé€Ÿ

```python
# ä½¿ç”¨çº¿ç¨‹æ± å¹¶å‘æ‰«æå¤šä¸ªIP
with ThreadPoolExecutor(max_workers=50) as executor:
    # 50ä¸ªçº¿ç¨‹åŒæ—¶å·¥ä½œ
    futures = {executor.submit(ping_and_get_mac, ip): ip
               for ip in net.hosts()}
```

### 3. MACåœ°å€å‚å•†è¯†åˆ«

```python
# é€šè¿‡MACåœ°å€å‰3ä¸ªå­—èŠ‚ï¼ˆOUIï¼‰è¯†åˆ«å‚å•†
oui = mac[:8]  # å¦‚ "00:50:56"
vendor = oui_database.get(oui, 'æœªçŸ¥å‚å•†')
```

## ğŸ“ çŸ¥è¯†å°ç»“

ä»Šå¤©å­¦ä¹ äº†ï¼š

1. âœ… MACåœ°å€æ˜¯ç½‘å¡çš„ç‰©ç†åœ°å€ï¼Œå…¨çƒå”¯ä¸€
2. âœ… MACåœ°å€å·¥ä½œåœ¨æ•°æ®é“¾è·¯å±‚
3. âœ… ARPåè®®ç”¨äºIPåœ°å€åˆ°MACåœ°å€çš„è½¬æ¢
4. âœ… ARPä½¿ç”¨å¹¿æ’­è¯·æ±‚ï¼Œå•æ’­å“åº”
5. âœ… ç³»ç»Ÿä¼šç¼“å­˜ARPè§£æç»“æœ

### é‡è¦æ¦‚å¿µ

| æ¦‚å¿µ | è¯´æ˜ |
|------|------|
| MACåœ°å€ | 48ä½ç‰©ç†åœ°å€ï¼Œå›ºåŒ–åœ¨ç½‘å¡ |
| OUI | MACåœ°å€å‰24ä½ï¼Œå‚å•†æ ‡è¯† |
| ARP | åœ°å€è§£æåè®®ï¼ŒIPâ†’MAC |
| ARPç¼“å­˜ | ç³»ç»Ÿç¼“å­˜çš„IP-MACæ˜ å°„è¡¨ |
| å¹¿æ’­MAC | FF:FF:FF:FF:FF:FF |

## ğŸ’ª ç»ƒä¹ é¢˜

### ç»ƒä¹ 1ï¼šæŸ¥çœ‹æœ¬æœºä¿¡æ¯
1. æŸ¥çœ‹æœ¬æœºçš„MACåœ°å€
2. æŸ¥çœ‹æœ¬æœºçš„ARPç¼“å­˜
3. æ‰¾å‡ºè·¯ç”±å™¨çš„MACåœ°å€

### ç»ƒä¹ 2ï¼šç†è§£ARP
1. ç”»å‡ºARPè¯·æ±‚å’Œå“åº”çš„å®Œæ•´è¿‡ç¨‹
2. è§£é‡Šä¸ºä»€ä¹ˆARPè¯·æ±‚ä½¿ç”¨å¹¿æ’­
3. ARPç¼“å­˜çš„ä½œç”¨æ˜¯ä»€ä¹ˆï¼Ÿ

### ç»ƒä¹ 3ï¼šå®è·µæ“ä½œ
1. æ¸…ç©ºARPç¼“å­˜
2. Pingä¸€ä¸ªå±€åŸŸç½‘å†…çš„è®¾å¤‡
3. å†æ¬¡æŸ¥çœ‹ARPç¼“å­˜ï¼Œè§‚å¯Ÿå˜åŒ–

### ç»ƒä¹ 4ï¼šå®‰å…¨æ€è€ƒ
1. ä»€ä¹ˆæ˜¯ARPæ¬ºéª—ï¼ˆARP Spoofingï¼‰ï¼Ÿ
2. å¦‚ä½•é˜²èŒƒARPæ”»å‡»ï¼Ÿ
3. ä¸ºä»€ä¹ˆARPåè®®ä¸å®‰å…¨ï¼Ÿ

---

ğŸ’¡ **ä»Šæ—¥é‡‘å¥**ï¼šMACåœ°å€æ˜¯ç½‘ç»œä¸–ç•Œçš„èº«ä»½è¯ï¼

ğŸ‘‰ [ä¸Šä¸€å¤©ï¼šå­ç½‘åˆ’åˆ†å®æˆ˜](day09.md) | [è¿”å›ç›®å½•](../../README.md) | [ä¸‹ä¸€å¤©ï¼šç«¯å£å’ŒSocketæ·±å…¥](day11.md)

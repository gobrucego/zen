# ç¬¬29å¤©ï¼šHTTP/3å’ŒQUICåè®®

> "HTTP/3å°±åƒç»™äº’è”ç½‘è£…ä¸Šäº†ç«ç®­å¼•æ“ï¼Œæ›´å¿«ã€æ›´ç¨³ã€æ›´å¯é ï¼"

## ğŸ“š ä»Šæ—¥ç›®æ ‡

- ç†è§£HTTP/2çš„é—ç•™é—®é¢˜
- æŒæ¡QUICåè®®çš„æ ¸å¿ƒç‰¹æ€§
- å­¦ä¹ HTTP/3çš„æ”¹è¿›
- ç†è§£0-RTTè¿æ¥å»ºç«‹
- äº†è§£UDPåœ¨ä¼ è¾“å±‚çš„åº”ç”¨

---

## 1. ä¸ºä»€ä¹ˆéœ€è¦HTTP/3ï¼Ÿ

### 1.1 HTTP/2çš„é—®é¢˜

```
HTTP/2è™½ç„¶è§£å†³äº†åº”ç”¨å±‚çš„é˜Ÿå¤´é˜»å¡ï¼Œ
ä½†åœ¨ä¼ è¾“å±‚ä»ç„¶å­˜åœ¨é—®é¢˜ï¼š

TCPå±‚é˜Ÿå¤´é˜»å¡ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  HTTP/2è¿æ¥ï¼ˆåŸºäºTCPï¼‰                     â”‚
â”‚  â”œâ”€ æµ1: [åŒ…1][åŒ…2][åŒ…3]                   â”‚
â”‚  â”œâ”€ æµ2: [åŒ…1][åŒ…2][åŒ…3]                   â”‚
â”‚  â””â”€ æµ3: [åŒ…1][åŒ…2][åŒ…3]                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â†“
    TCPä¼ è¾“å±‚
         â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  å¦‚æœæµ1çš„åŒ…2ä¸¢å¤±ï¼š                        â”‚
â”‚  â”œâ”€ æµ1: [åŒ…1] [X] [ç­‰å¾…]                 â”‚
â”‚  â”œâ”€ æµ2: [åŒ…1] [åŒ…2] [ç­‰å¾…] â† è¢«é˜»å¡ï¼    â”‚
â”‚  â””â”€ æµ3: [åŒ…1] [åŒ…2] [ç­‰å¾…] â† è¢«é˜»å¡ï¼    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

é—®é¢˜ï¼š
TCPè¦æ±‚æŒ‰åºäº¤ä»˜ï¼Œä¸€ä¸ªåŒ…ä¸¢å¤±ä¼šé˜»å¡æ‰€æœ‰åç»­åŒ…
å³ä½¿å…¶ä»–æµçš„æ•°æ®å·²ç»åˆ°è¾¾ï¼Œä¹Ÿå¿…é¡»ç­‰å¾…

ç”Ÿæ´»åŒ–ç±»æ¯”ï¼š
TCP = å•è½¨ç«è½¦
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ [è½¦å¢1][è½¦å¢2][X][è½¦å¢4]... â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
è½¦å¢3è„±è½¨ â†’ åé¢æ‰€æœ‰è½¦å¢éƒ½è¦ç­‰å¾…

QUIC = å¤šè½¨é“ç‹¬ç«‹åˆ—è½¦
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ è½¨é“1: [è½¦å¢1][è½¦å¢2][è½¦å¢3]â”‚
â”‚ è½¨é“2: [è½¦å¢1][X][ç­‰å¾…]     â”‚ â† åªå½±å“è½¨é“2
â”‚ è½¨é“3: [è½¦å¢1][è½¦å¢2][è½¦å¢3]â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 1.2 å…¶ä»–é—®é¢˜

```
HTTP/2çš„å…¶ä»–é™åˆ¶ï¼š

1. è¿æ¥å»ºç«‹æ…¢
   TCPæ¡æ‰‹ï¼š1-RTT
   TLSæ¡æ‰‹ï¼š1-2 RTT
   æ€»è®¡ï¼š2-3 RTTæ‰èƒ½å‘é€æ•°æ®

   ç¤ºä¾‹ï¼ˆé¦–æ¬¡è¿æ¥ï¼‰ï¼š
   å®¢æˆ·ç«¯ â†’ SYN                     â†’ æœåŠ¡å™¨
   å®¢æˆ·ç«¯ â† SYN-ACK                 â† æœåŠ¡å™¨  (1-RTT)
   å®¢æˆ·ç«¯ â†’ ACK                     â†’ æœåŠ¡å™¨

   å®¢æˆ·ç«¯ â†’ Client Hello            â†’ æœåŠ¡å™¨
   å®¢æˆ·ç«¯ â† Server Hello, è¯ä¹¦ç­‰     â† æœåŠ¡å™¨  (2-RTT)
   å®¢æˆ·ç«¯ â†’ Client Finished         â†’ æœåŠ¡å™¨

   å®¢æˆ·ç«¯ â†’ HTTPè¯·æ±‚                â†’ æœåŠ¡å™¨  (3-RTT)

   æ€»å»¶è¿Ÿï¼š3-RTT

2. è¿æ¥è¿ç§»å›°éš¾
   - TCPè¿æ¥ç”±å››å…ƒç»„æ ‡è¯†ï¼ˆæºIPã€æºç«¯å£ã€ç›®æ ‡IPã€ç›®æ ‡ç«¯å£ï¼‰
   - WiFiåˆ‡æ¢åˆ°4Gï¼ŒIPå˜åŒ– â†’ è¿æ¥æ–­å¼€ â†’ éœ€è¦é‡æ–°å»ºç«‹

3. æ¡æ‰‹å†—ä½™
   - TCPå’ŒTLSåˆ†åˆ«æ¡æ‰‹
   - æ•°æ®é‡å¤ï¼ˆå¦‚éšæœºæ•°ï¼‰
```

---

## 2. QUICåè®®è¯¦è§£

### 2.1 QUICæ¦‚è¿°

```
QUIC (Quick UDP Internet Connections)

æ ¸å¿ƒç‰¹ç‚¹ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  QUIC = UDP + å¯é æ€§ + åŠ å¯† + å¤šè·¯å¤ç”¨  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

åè®®æ ˆå¯¹æ¯”ï¼š

HTTP/2:
åº”ç”¨å±‚:  HTTP/2
ä¼ è¾“å±‚:  TCP
å®‰å…¨å±‚:  TLS 1.2/1.3
ç½‘ç»œå±‚:  IP

HTTP/3:
åº”ç”¨å±‚:  HTTP/3
ä¼ è¾“å±‚:  QUIC (åŒ…å«åŠ å¯†ã€å¯é æ€§)
ç½‘ç»œå±‚:  UDP + IP

ä¼˜åŠ¿ï¼š
âœ… 0-RTTæˆ–1-RTTè¿æ¥å»ºç«‹
âœ… æ— é˜Ÿå¤´é˜»å¡
âœ… è¿æ¥è¿ç§»
âœ… æ”¹è¿›çš„æ‹¥å¡æ§åˆ¶
âœ… å‰å‘çº é”™ï¼ˆFECï¼‰
```

### 2.2 QUICè¿æ¥å»ºç«‹

```
QUICæ¡æ‰‹æµç¨‹ï¼ˆ1-RTTï¼‰ï¼š

é¦–æ¬¡è¿æ¥ï¼š
å®¢æˆ·ç«¯ â†’ Initial Packet                    â†’ æœåŠ¡å™¨
         (Client Hello + QUICå‚æ•°)
å®¢æˆ·ç«¯ â† Handshake Packet                  â† æœåŠ¡å™¨  (1-RTT)
         (Server Hello + è¯ä¹¦ + Finished)
å®¢æˆ·ç«¯ â†’ Handshake Packet + Application Data â†’ æœåŠ¡å™¨
         (Finished + HTTPè¯·æ±‚)

æ€»å»¶è¿Ÿï¼š1-RTTå³å¯å‘é€æ•°æ®ï¼

---

å†æ¬¡è¿æ¥ï¼ˆ0-RTTï¼‰ï¼š
å®¢æˆ·ç«¯ä¿å­˜äº†æœåŠ¡å™¨çš„é…ç½®å’Œå¯†é’¥
å®¢æˆ·ç«¯ â†’ Initial Packet + Application Data â†’ æœåŠ¡å™¨
         (ä¹‹å‰çš„å¯†é’¥ + HTTPè¯·æ±‚)

æ€»å»¶è¿Ÿï¼š0-RTTï¼æ•°æ®ç«‹å³å‘é€ï¼

å¯¹æ¯”ï¼š
HTTP/2 é¦–æ¬¡è¿æ¥: 3-RTT
HTTP/3 é¦–æ¬¡è¿æ¥: 1-RTT  âœ… å¿«2å€

HTTP/2 å†æ¬¡è¿æ¥: 2-RTT (TLSä¼šè¯æ¢å¤)
HTTP/3 å†æ¬¡è¿æ¥: 0-RTT  âœ… æ— å»¶è¿Ÿ
```

### 2.3 QUICæ•°æ®åŒ…ç»“æ„

```
QUICæ•°æ®åŒ…æ ¼å¼ï¼š

é•¿å¤´éƒ¨æ ¼å¼ï¼ˆLong Headerï¼‰ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Header Form (1) = 1                      â”‚
â”‚ Fixed Bit (1) = 1                        â”‚
â”‚ Long Packet Type (2)                     â”‚
â”‚ Type-Specific Bits (4)                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Version (32)                             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Destination Connection ID Length (8)     â”‚
â”‚ Destination Connection ID (0..160)       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Source Connection ID Length (8)          â”‚
â”‚ Source Connection ID (0..160)            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Type-Specific Payload                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

çŸ­å¤´éƒ¨æ ¼å¼ï¼ˆShort Headerï¼‰ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Header Form (1) = 0                      â”‚
â”‚ Fixed Bit (1) = 1                        â”‚
â”‚ Spin Bit (1)                             â”‚
â”‚ Reserved Bits (2)                        â”‚
â”‚ Key Phase (1)                            â”‚
â”‚ Packet Number Length (2)                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Destination Connection ID (0..160)       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Packet Number (8..32)                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Protected Payload                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

å…³é”®å­—æ®µï¼š
- Connection ID: è¿æ¥æ ‡è¯†ç¬¦ï¼ˆä¸æ˜¯IP+ç«¯å£ï¼‰
- Packet Number: åŒ…åºå·ï¼ˆç”¨äºç¡®è®¤å’Œé‡ä¼ ï¼‰
- Protected Payload: åŠ å¯†çš„è´Ÿè½½
```

### 2.4 QUICæµï¼ˆStreamï¼‰

```
QUICæµçš„ç‰¹ç‚¹ï¼š

1. ç‹¬ç«‹çš„æµ
   æ¯ä¸ªæµæœ‰ç‹¬ç«‹çš„åºå·ç©ºé—´
   ä¸€ä¸ªæµçš„ä¸¢åŒ…ä¸å½±å“å…¶ä»–æµ

ç¤ºä¾‹ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  QUICè¿æ¥                                â”‚
â”‚  â”œâ”€ æµ0: [åŒ…0][åŒ…1][åŒ…2] âœ… å®Œæˆ        â”‚
â”‚  â”œâ”€ æµ4: [åŒ…0][X][ç­‰å¾…]  â¸ï¸ åªå½±å“æµ4  â”‚
â”‚  â”œâ”€ æµ8: [åŒ…0][åŒ…1][åŒ…2] âœ… å®Œæˆ        â”‚
â”‚  â””â”€ æµ12:[åŒ…0][åŒ…1]      âœ… ç»§ç»­ä¼ è¾“    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

2. æµçš„ç±»å‹
   - å•å‘æµï¼šåªèƒ½å•å‘å‘é€æ•°æ®
   - åŒå‘æµï¼šå¯ä»¥åŒå‘å‘é€æ•°æ®

3. æµçš„ID
   - å®¢æˆ·ç«¯å‘èµ·çš„åŒå‘æµï¼š0, 4, 8, 12...
   - æœåŠ¡å™¨å‘èµ·çš„åŒå‘æµï¼š1, 5, 9, 13...
   - å®¢æˆ·ç«¯å‘èµ·çš„å•å‘æµï¼š2, 6, 10, 14...
   - æœåŠ¡å™¨å‘èµ·çš„å•å‘æµï¼š3, 7, 11, 15...
```

### 2.5 è¿æ¥è¿ç§»

```
QUICè¿æ¥è¿ç§»ï¼š

ä¼ ç»ŸTCPï¼š
WiFi:   192.168.1.100:5000 â†â†’ Server:443
        â†“ (WiFi â†’ 4G)
4G:     10.0.0.50:5000     â†â†’ Server:443
        âŒ IPå˜åŒ–ï¼Œè¿æ¥æ–­å¼€ï¼Œéœ€è¦é‡æ–°å»ºç«‹

QUICï¼š
WiFi:   192.168.1.100:5000 â†â†’ Server:443
        Connection ID: abc123
        â†“ (WiFi â†’ 4G)
4G:     10.0.0.50:5000     â†â†’ Server:443
        Connection ID: abc123  âœ… ä»ç„¶æ˜¯åŒä¸€ä¸ªè¿æ¥ï¼

åŸç†ï¼š
- QUICä½¿ç”¨Connection IDæ ‡è¯†è¿æ¥
- Connection IDä¸ä¾èµ–äºIPåœ°å€å’Œç«¯å£
- ç½‘ç»œåˆ‡æ¢æ—¶ï¼Œåªéœ€è¦å‘é€æ–°çš„åŒ…
- æœåŠ¡å™¨è¯†åˆ«Connection IDï¼Œç»§ç»­åŸè¿æ¥

è¿ç§»è¿‡ç¨‹ï¼š
1. å®¢æˆ·ç«¯æ£€æµ‹åˆ°IPå˜åŒ–
2. ä½¿ç”¨æ–°IPå‘é€å¸¦æœ‰ç›¸åŒConnection IDçš„åŒ…
3. æœåŠ¡å™¨éªŒè¯Connection ID
4. æ›´æ–°è·¯å¾„ä¿¡æ¯ï¼Œç»§ç»­é€šä¿¡
5. æ— éœ€é‡æ–°æ¡æ‰‹ï¼

åº”ç”¨åœºæ™¯ï¼š
- æ‰‹æœºWiFiåˆ‡æ¢åˆ°4G
- ç¬”è®°æœ¬ä»å®¶é‡Œç§»åŠ¨åˆ°å’–å•¡åº—
- è´Ÿè½½å‡è¡¡å™¨åˆ‡æ¢
```

---

## 3. HTTP/3è¯¦è§£

### 3.1 HTTP/3æ¶æ„

```
HTTP/3 = HTTP/2è¯­ä¹‰ + QUICä¼ è¾“

åè®®æ˜ å°„ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  HTTP/3                                 â”‚
â”‚  - è¯·æ±‚/å“åº”æ¨¡å‹                         â”‚
â”‚  - å¤´éƒ¨å‹ç¼©ï¼ˆQPACKï¼‰                     â”‚
â”‚  - æœåŠ¡å™¨æ¨é€                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  QUIC                                   â”‚
â”‚  - æµï¼ˆStreamsï¼‰                         â”‚
â”‚  - è¿æ¥ç®¡ç†                              â”‚
â”‚  - å¯é ä¼ è¾“                              â”‚
â”‚  - åŠ å¯†ï¼ˆTLS 1.3ï¼‰                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  UDP                                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

å¸§ç±»å‹ï¼ˆHTTP/3ç‰¹æœ‰ï¼‰ï¼š
- DATA: ä¼ è¾“HTTPæ¶ˆæ¯ä½“
- HEADERS: ä¼ è¾“HTTPå¤´éƒ¨ï¼ˆQPACKå‹ç¼©ï¼‰
- SETTINGS: è®¾ç½®å‚æ•°
- PUSH_PROMISE: æœåŠ¡å™¨æ¨é€
- GOAWAY: å…³é—­è¿æ¥
- MAX_PUSH_ID: é™åˆ¶æ¨é€ID
- CANCEL_PUSH: å–æ¶ˆæ¨é€
```

### 3.2 QPACKå¤´éƒ¨å‹ç¼©

```
QPACK vs HPACKï¼š

HPACKï¼ˆHTTP/2ï¼‰é—®é¢˜ï¼š
- åŠ¨æ€è¡¨éœ€è¦æŒ‰åºæ›´æ–°
- ä¸€ä¸ªæµçš„å¤´éƒ¨é˜»å¡ä¼šå½±å“å…¶ä»–æµ

QPACKæ”¹è¿›ï¼š
- å…è®¸ä¹±åºæ›´æ–°åŠ¨æ€è¡¨
- ä½¿ç”¨ä¸“ç”¨çš„ç¼–ç æµå’Œè§£ç æµ
- é¿å…é˜Ÿå¤´é˜»å¡

QPACKæ¶æ„ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ç¼–ç å™¨æµï¼ˆEncoder Streamï¼‰              â”‚
â”‚  - å‘é€åŠ¨æ€è¡¨æ›´æ–°                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  è¯·æ±‚æµï¼ˆRequest Streamsï¼‰               â”‚
â”‚  - å¼•ç”¨åŠ¨æ€è¡¨                            â”‚
â”‚  - å‘é€å‹ç¼©çš„å¤´éƒ¨                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  è§£ç å™¨æµï¼ˆDecoder Streamï¼‰              â”‚
â”‚  - ç¡®è®¤åŠ¨æ€è¡¨æ›´æ–°                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

å·¥ä½œæµç¨‹ï¼š
1. ç¼–ç å™¨å‘é€åŠ¨æ€è¡¨æ’å…¥æŒ‡ä»¤
2. è¯·æ±‚æµå¼•ç”¨åŠ¨æ€è¡¨æ¡ç›®
3. è§£ç å™¨ç¡®è®¤æ”¶åˆ°æ’å…¥æŒ‡ä»¤
4. ç¼–ç å™¨å¯ä»¥å®‰å…¨åœ°é©±é€æ—§æ¡ç›®
```

### 3.3 HTTP/3æ€§èƒ½ä¼˜åŠ¿

```
æ€§èƒ½å¯¹æ¯”ï¼š

åœºæ™¯1ï¼šé¦–æ¬¡è®¿é—®ç½‘ç«™
HTTP/2:
â”œâ”€ TCPæ¡æ‰‹: 50ms
â”œâ”€ TLSæ¡æ‰‹: 50ms
â”œâ”€ HTTPè¯·æ±‚: 50ms
â””â”€ æ€»è®¡: 150ms

HTTP/3:
â”œâ”€ QUICæ¡æ‰‹+è¯·æ±‚: 50ms
â””â”€ æ€»è®¡: 50ms  âœ… å¿«3å€

---

åœºæ™¯2ï¼šå¼±ç½‘ç¯å¢ƒï¼ˆä¸¢åŒ…ç‡5%ï¼‰
HTTP/2:
â”œâ”€ ä¸¢åŒ…å¯¼è‡´TCPé‡ä¼ 
â”œâ”€ æ‰€æœ‰æµè¢«é˜»å¡
â””â”€ æ€»è®¡: 1000ms

HTTP/3:
â”œâ”€ ä¸¢åŒ…åªå½±å“ç‰¹å®šæµ
â”œâ”€ å…¶ä»–æµç»§ç»­ä¼ è¾“
â””â”€ æ€»è®¡: 400ms  âœ… å¿«2.5å€

---

åœºæ™¯3ï¼šç§»åŠ¨ç½‘ç»œåˆ‡æ¢
HTTP/2:
â”œâ”€ è¿æ¥æ–­å¼€
â”œâ”€ é‡æ–°å»ºç«‹è¿æ¥: 150ms
â”œâ”€ é‡æ–°è¯·æ±‚æ•°æ®
â””â”€ æ€»è®¡: 300ms

HTTP/3:
â”œâ”€ è¿æ¥è¿ç§»
â”œâ”€ æ— éœ€é‡æ–°å»ºç«‹
â””â”€ æ€»è®¡: 10ms  âœ… å¿«30å€
```

---

## 4. å®æˆ˜é¡¹ç›®ï¼šHTTP/3æ¦‚å¿µæ¼”ç¤º

### 4.1 é¡¹ç›®è¯´æ˜

```
æ³¨æ„ï¼šHTTP/3å®ç°éœ€è¦ä¸“é—¨çš„åº“æ”¯æŒ
æœ¬é¡¹ç›®å°†æ¼”ç¤ºæ ¸å¿ƒæ¦‚å¿µå’Œæ¨¡æ‹Ÿå®ç°

åŠŸèƒ½ï¼š
1. QUICè¿æ¥å»ºç«‹æ¨¡æ‹Ÿ
2. 0-RTTæ¼”ç¤º
3. è¿æ¥è¿ç§»æ¼”ç¤º
4. æ€§èƒ½å¯¹æ¯”åˆ†æ
```

### 4.2 ä»£ç å®ç°

```python
# day29_http3_demo.py
# åŠŸèƒ½ï¼šHTTP/3å’ŒQUICåè®®æ¦‚å¿µæ¼”ç¤º

import time
import random
from typing import Dict, List, Tuple
from enum import Enum


class PacketType(Enum):
    """QUICæ•°æ®åŒ…ç±»å‹"""
    INITIAL = "Initial"
    HANDSHAKE = "Handshake"
    RETRY = "Retry"
    ZERORTT = "0-RTT"
    ONERTT = "1-RTT"


class QUICPacket:
    """
    QUICæ•°æ®åŒ…æ¨¡æ‹Ÿ

    å±æ€§ï¼š
        packet_type: æ•°æ®åŒ…ç±»å‹
        connection_id: è¿æ¥ID
        packet_number: åŒ…åºå·
        payload: è´Ÿè½½æ•°æ®
    """

    def __init__(self, packet_type: PacketType, connection_id: str,
                 packet_number: int, payload: str = ""):
        self.packet_type = packet_type
        self.connection_id = connection_id
        self.packet_number = packet_number
        self.payload = payload
        self.timestamp = time.time()

    def __repr__(self):
        return (f"QUICPacket(type={self.packet_type.value}, "
                f"conn_id={self.connection_id}, "
                f"pkt_num={self.packet_number})")


class QUICConnection:
    """
    QUICè¿æ¥æ¨¡æ‹Ÿ

    åŠŸèƒ½ï¼š
        1. è¿æ¥å»ºç«‹ï¼ˆ1-RTTå’Œ0-RTTï¼‰
        2. æ•°æ®ä¼ è¾“
        3. è¿æ¥è¿ç§»
    """

    def __init__(self, connection_id: str):
        """
        åˆå§‹åŒ–QUICè¿æ¥

        å‚æ•°ï¼š
            connection_id: è¿æ¥æ ‡è¯†ç¬¦
        """
        self.connection_id = connection_id
        self.is_established = False
        self.packet_number = 0
        self.rtt = 50  # æ¨¡æ‹Ÿå¾€è¿”æ—¶é—´ï¼ˆæ¯«ç§’ï¼‰
        self.sent_packets = []
        self.received_packets = []
        self.session_ticket = None  # ç”¨äº0-RTT
        self.client_ip = "192.168.1.100"
        self.server_ip = "93.184.216.34"

    def handshake_1rtt(self):
        """
        1-RTTæ¡æ‰‹ï¼ˆé¦–æ¬¡è¿æ¥ï¼‰

        å·¥ä½œæµç¨‹ï¼š
            å®¢æˆ·ç«¯ â†’ Initial (Client Hello)
            æœåŠ¡å™¨ â†’ Handshake (Server Hello, Certificate, Finished)
            å®¢æˆ·ç«¯ â†’ Handshake (Finished) + 1-RTT (Application Data)
        """
        print("\n" + "="*60)
        print(" QUIC 1-RTTæ¡æ‰‹æ¼”ç¤º")
        print("="*60)

        print(f"\nè¿æ¥ID: {self.connection_id}")
        print(f"å®¢æˆ·ç«¯: {self.client_ip}")
        print(f"æœåŠ¡å™¨: {self.server_ip}")
        print(f"RTT: {self.rtt}ms")

        start_time = time.time()

        # æ­¥éª¤1ï¼šå®¢æˆ·ç«¯å‘é€InitialåŒ…
        print("\n[0ms] å®¢æˆ·ç«¯ â†’ Initial Packet")
        initial_pkt = QUICPacket(
            PacketType.INITIAL,
            self.connection_id,
            self.packet_number,
            "Client Hello + QUIC Parameters"
        )
        self.sent_packets.append(initial_pkt)
        self.packet_number += 1
        print(f"  å†…å®¹: {initial_pkt.payload}")

        # æ¨¡æ‹Ÿç½‘ç»œå»¶è¿Ÿ
        time.sleep(self.rtt / 2000)  # RTTçš„ä¸€åŠ

        # æ­¥éª¤2ï¼šæœåŠ¡å™¨å“åº”HandshakeåŒ…
        print(f"\n[{self.rtt//2}ms] æœåŠ¡å™¨ â†’ Handshake Packet")
        handshake_pkt = QUICPacket(
            PacketType.HANDSHAKE,
            self.connection_id,
            0,
            "Server Hello + Certificate + Finished"
        )
        self.received_packets.append(handshake_pkt)
        print(f"  å†…å®¹: {handshake_pkt.payload}")

        # æ¨¡æ‹Ÿç½‘ç»œå»¶è¿Ÿ
        time.sleep(self.rtt / 2000)

        # æ­¥éª¤3ï¼šå®¢æˆ·ç«¯å‘é€Finishedå’Œåº”ç”¨æ•°æ®
        print(f"\n[{self.rtt}ms] å®¢æˆ·ç«¯ â†’ Handshake + 1-RTT Data")
        finished_pkt = QUICPacket(
            PacketType.HANDSHAKE,
            self.connection_id,
            self.packet_number,
            "Finished"
        )
        self.sent_packets.append(finished_pkt)
        self.packet_number += 1
        print(f"  æ¡æ‰‹å®Œæˆ")

        data_pkt = QUICPacket(
            PacketType.ONERTT,
            self.connection_id,
            self.packet_number,
            "HTTP/3 GET /index.html"
        )
        self.sent_packets.append(data_pkt)
        self.packet_number += 1
        print(f"  åº”ç”¨æ•°æ®: {data_pkt.payload}")

        # è¿æ¥å»ºç«‹å®Œæˆ
        self.is_established = True

        # ä¿å­˜ä¼šè¯ç¥¨æ®ç”¨äº0-RTT
        self.session_ticket = f"ticket_{self.connection_id}_{int(time.time())}"

        elapsed = (time.time() - start_time) * 1000
        print(f"\nâœ… è¿æ¥å»ºç«‹å®Œæˆï¼")
        print(f"æ€»è€—æ—¶: {elapsed:.2f}ms (çº¦1-RTT)")
        print(f"ä¼šè¯ç¥¨æ®: {self.session_ticket}")

        return elapsed

    def handshake_0rtt(self):
        """
        0-RTTæ¡æ‰‹ï¼ˆå†æ¬¡è¿æ¥ï¼‰

        å·¥ä½œåŸç†ï¼š
            å®¢æˆ·ç«¯ä½¿ç”¨ä¹‹å‰ä¿å­˜çš„ä¼šè¯ç¥¨æ®å’Œå¯†é’¥
            å¯ä»¥åœ¨ç¬¬ä¸€ä¸ªæ•°æ®åŒ…ä¸­å°±å‘é€åº”ç”¨æ•°æ®
        """
        if not self.session_ticket:
            print("âŒ æ²¡æœ‰ä¼šè¯ç¥¨æ®ï¼Œæ— æ³•ä½¿ç”¨0-RTT")
            return None

        print("\n" + "="*60)
        print(" QUIC 0-RTTæ¡æ‰‹æ¼”ç¤º")
        print("="*60)

        print(f"\nè¿æ¥ID: {self.connection_id}")
        print(f"ä¼šè¯ç¥¨æ®: {self.session_ticket}")
        print("ä½¿ç”¨ä¹‹å‰ä¿å­˜çš„å¯†é’¥")

        start_time = time.time()

        # æ­¥éª¤1ï¼šå®¢æˆ·ç«¯ç›´æ¥å‘é€åº”ç”¨æ•°æ®
        print("\n[0ms] å®¢æˆ·ç«¯ â†’ Initial + 0-RTT Data")
        initial_pkt = QUICPacket(
            PacketType.ZERORTT,
            self.connection_id,
            self.packet_number,
            "HTTP/3 GET /style.css"
        )
        self.sent_packets.append(initial_pkt)
        self.packet_number += 1
        print(f"  ä¼šè¯ç¥¨æ®: {self.session_ticket}")
        print(f"  åº”ç”¨æ•°æ®: {initial_pkt.payload}")

        elapsed = (time.time() - start_time) * 1000
        print(f"\nâœ… 0-RTTå‘é€å®Œæˆï¼æ— éœ€ç­‰å¾…æ¡æ‰‹ï¼")
        print(f"æ€»è€—æ—¶: {elapsed:.2f}ms (0-RTT)")

        return elapsed

    def migrate_connection(self, new_ip: str):
        """
        è¿æ¥è¿ç§»æ¼”ç¤º

        å‚æ•°ï¼š
            new_ip: æ–°çš„IPåœ°å€

        å·¥ä½œåŸç†ï¼š
            ä½¿ç”¨Connection IDæ ‡è¯†è¿æ¥
            IPå˜åŒ–ä¸å½±å“è¿æ¥çŠ¶æ€
        """
        print("\n" + "="*60)
        print(" QUICè¿æ¥è¿ç§»æ¼”ç¤º")
        print("="*60)

        old_ip = self.client_ip

        print(f"\nç½‘ç»œåˆ‡æ¢æ£€æµ‹:")
        print(f"  æ—§IP: {old_ip} (WiFi)")
        print(f"  æ–°IP: {new_ip} (4G)")
        print(f"  è¿æ¥ID: {self.connection_id}")

        start_time = time.time()

        # æ›´æ–°IP
        self.client_ip = new_ip

        # ä½¿ç”¨æ–°IPå‘é€æ•°æ®åŒ…
        print(f"\nä½¿ç”¨æ–°IPå‘é€æ•°æ®åŒ…...")
        migration_pkt = QUICPacket(
            PacketType.ONERTT,
            self.connection_id,  # Connection IDä¸å˜
            self.packet_number,
            "Path Challenge"
        )
        self.sent_packets.append(migration_pkt)
        self.packet_number += 1

        # æ¨¡æ‹Ÿç½‘ç»œå»¶è¿Ÿ
        time.sleep(self.rtt / 1000)

        print(f"  æœåŠ¡å™¨è¯†åˆ«Connection ID: {self.connection_id}")
        print(f"  æ›´æ–°è·¯å¾„: {old_ip} â†’ {new_ip}")
        print(f"  éªŒè¯æ–°è·¯å¾„...")

        response_pkt = QUICPacket(
            PacketType.ONERTT,
            self.connection_id,
            0,
            "Path Response"
        )
        self.received_packets.append(response_pkt)

        elapsed = (time.time() - start_time) * 1000
        print(f"\nâœ… è¿æ¥è¿ç§»å®Œæˆï¼")
        print(f"æ€»è€—æ—¶: {elapsed:.2f}ms")
        print(f"æ— éœ€é‡æ–°æ¡æ‰‹ï¼Œç»§ç»­ä½¿ç”¨åŸè¿æ¥ï¼")

        return elapsed

    def send_data(self, data: str, stream_id: int):
        """
        å‘é€åº”ç”¨æ•°æ®

        å‚æ•°ï¼š
            data: è¦å‘é€çš„æ•°æ®
            stream_id: æµID
        """
        pkt = QUICPacket(
            PacketType.ONERTT,
            self.connection_id,
            self.packet_number,
            f"Stream {stream_id}: {data}"
        )
        self.sent_packets.append(pkt)
        self.packet_number += 1
        print(f"å‘é€æ•°æ®: {pkt.payload}")


class ProtocolComparison:
    """
    åè®®æ€§èƒ½å¯¹æ¯”
    """

    @staticmethod
    def compare_handshake():
        """
        å¯¹æ¯”æ¡æ‰‹æ€§èƒ½
        """
        print("\n" + "="*60)
        print(" åè®®æ¡æ‰‹æ€§èƒ½å¯¹æ¯”")
        print("="*60)

        rtt = 50  # å‡è®¾RTTä¸º50ms

        print(f"\nå‡è®¾æ¡ä»¶ï¼šRTT = {rtt}ms\n")

        # HTTP/1.1
        print("HTTP/1.1 over TCP + TLS:")
        print("  TCPæ¡æ‰‹:     1-RTT ({rtt}ms)")
        print("  TLSæ¡æ‰‹:     2-RTT ({rtt*2}ms)")
        print("  HTTPè¯·æ±‚:    1-RTT ({rtt}ms)")
        http1_total = rtt * 4
        print(f"  æ€»è®¡:        4-RTT ({http1_total}ms)")

        # HTTP/2
        print(f"\nHTTP/2 over TCP + TLS 1.3:")
        print(f"  TCPæ¡æ‰‹:     1-RTT ({rtt}ms)")
        print(f"  TLS 1.3æ¡æ‰‹: 1-RTT ({rtt}ms)")
        print(f"  HTTPè¯·æ±‚:    1-RTT ({rtt}ms)")
        http2_total = rtt * 3
        print(f"  æ€»è®¡:        3-RTT ({http2_total}ms)")

        # HTTP/3 (1-RTT)
        print(f"\nHTTP/3 over QUIC (1-RTT):")
        print(f"  QUICæ¡æ‰‹+è¯·æ±‚: 1-RTT ({rtt}ms)")
        http3_1rtt = rtt
        print(f"  æ€»è®¡:        1-RTT ({http3_1rtt}ms)")

        # HTTP/3 (0-RTT)
        print(f"\nHTTP/3 over QUIC (0-RTT):")
        print(f"  ç›´æ¥å‘é€æ•°æ®: 0-RTT (0ms)")
        http3_0rtt = 0
        print(f"  æ€»è®¡:        0-RTT ({http3_0rtt}ms)")

        # æ€»ç»“
        print(f"\næ€§èƒ½æå‡ï¼š")
        print(f"  HTTP/3(1-RTT) vs HTTP/1.1: {(1 - http3_1rtt/http1_total)*100:.1f}%")
        print(f"  HTTP/3(1-RTT) vs HTTP/2:   {(1 - http3_1rtt/http2_total)*100:.1f}%")
        print(f"  HTTP/3(0-RTT) vs HTTP/2:   {(1 - http3_0rtt/http2_total)*100:.1f}%")

    @staticmethod
    def compare_packet_loss():
        """
        å¯¹æ¯”ä¸¢åŒ…å½±å“
        """
        print("\n" + "="*60)
        print(" ä¸¢åŒ…å½±å“å¯¹æ¯”")
        print("="*60)

        print("""
åœºæ™¯ï¼šåŒæ—¶ä¼ è¾“3ä¸ªæµï¼Œæ¯ä¸ªæµ10ä¸ªåŒ…ï¼Œç¬¬2ä¸ªæµä¸¢å¤±1ä¸ªåŒ…

HTTP/2 over TCP:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ æµ1: [1][2][3][4][5][6][7][8][9][10] â¸ï¸ ç­‰å¾…      â”‚
â”‚ æµ2: [1][X][ç­‰å¾…é‡ä¼ ...] â¸ï¸ é˜»å¡                  â”‚
â”‚ æµ3: [1][2][3][4][5][6][7][8][9][10] â¸ï¸ ç­‰å¾…      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
é—®é¢˜ï¼šTCPè¦æ±‚æŒ‰åºäº¤ä»˜ï¼Œæµ2çš„ä¸¢åŒ…é˜»å¡æ‰€æœ‰æµ
å½±å“ï¼šæ‰€æœ‰30ä¸ªåŒ…éƒ½è¦ç­‰å¾…æµ2é‡ä¼ å®Œæˆ

HTTP/3 over QUIC:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ æµ1: [1][2][3][4][5][6][7][8][9][10] âœ… å®Œæˆ       â”‚
â”‚ æµ2: [1][X][ç­‰å¾…é‡ä¼ ...] â¸ï¸ åªå½±å“æµ2            â”‚
â”‚ æµ3: [1][2][3][4][5][6][7][8][9][10] âœ… å®Œæˆ       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
ä¼˜åŠ¿ï¼šæ¯ä¸ªæµç‹¬ç«‹ï¼Œæµ2çš„ä¸¢åŒ…åªå½±å“æµ2è‡ªå·±
å½±å“ï¼šåªæœ‰1ä¸ªåŒ…éœ€è¦é‡ä¼ ï¼Œå…¶ä»–29ä¸ªåŒ…æ­£å¸¸ä¼ è¾“

æ€§èƒ½å·®å¼‚ï¼ˆä¸¢åŒ…ç‡5%ï¼‰ï¼š
- HTTP/2: æ‰€æœ‰ä¼ è¾“è¢«é˜»å¡ï¼Œå»¶è¿Ÿå¢åŠ 200%+
- HTTP/3: åªæœ‰å—å½±å“çš„æµéœ€è¦é‡ä¼ ï¼Œå»¶è¿Ÿå¢åŠ 10%

ç»“è®ºï¼šåœ¨å¼±ç½‘ç¯å¢ƒä¸‹ï¼ŒHTTP/3æ€§èƒ½ä¼˜åŠ¿æ›´æ˜æ˜¾
        """)


def main():
    """ä¸»ç¨‹åº"""
    print("""
    â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
    â•‘       HTTP/3 & QUIC åè®®æ¼”ç¤º v1.0                         â•‘
    â•‘       HTTP/3 & QUIC Protocol Demo                        â•‘
    â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    """)

    # ç”ŸæˆConnection ID
    conn_id = f"conn_{random.randint(10000, 99999)}"

    # åˆ›å»ºQUICè¿æ¥
    conn = QUICConnection(conn_id)

    # 1. æ¼”ç¤º1-RTTæ¡æ‰‹
    print("\nã€æ¼”ç¤º1ï¼šé¦–æ¬¡è¿æ¥ - 1-RTTæ¡æ‰‹ã€‘")
    rtt_1 = conn.handshake_1rtt()
    input("\næŒ‰Enterç»§ç»­...")

    # 2. æ¼”ç¤º0-RTTæ¡æ‰‹
    print("\nã€æ¼”ç¤º2ï¼šå†æ¬¡è¿æ¥ - 0-RTTæ¡æ‰‹ã€‘")
    rtt_0 = conn.handshake_0rtt()
    input("\næŒ‰Enterç»§ç»­...")

    # 3. æ¼”ç¤ºè¿æ¥è¿ç§»
    print("\nã€æ¼”ç¤º3ï¼šç½‘ç»œåˆ‡æ¢ - è¿æ¥è¿ç§»ã€‘")
    conn.migrate_connection("10.0.0.50")
    input("\næŒ‰Enterç»§ç»­...")

    # 4. æ€§èƒ½å¯¹æ¯”
    print("\nã€æ¼”ç¤º4ï¼šåè®®æ€§èƒ½å¯¹æ¯”ã€‘")
    ProtocolComparison.compare_handshake()
    input("\næŒ‰Enterç»§ç»­...")

    ProtocolComparison.compare_packet_loss()

    # æ€»ç»“
    print("\n" + "="*60)
    print(" æ€»ç»“")
    print("="*60)
    print("""
HTTP/3 å’Œ QUIC çš„æ ¸å¿ƒä¼˜åŠ¿ï¼š

1. æ›´å¿«çš„è¿æ¥å»ºç«‹
   âœ… 1-RTTæˆ–0-RTTï¼Œæ¯”HTTP/2å¿«2-3å€

2. æ¶ˆé™¤é˜Ÿå¤´é˜»å¡
   âœ… æ¯ä¸ªæµç‹¬ç«‹ï¼Œä¸¢åŒ…åªå½±å“å•ä¸ªæµ

3. è¿æ¥è¿ç§»
   âœ… ç½‘ç»œåˆ‡æ¢æ— éœ€é‡æ–°è¿æ¥

4. æ”¹è¿›çš„æ‹¥å¡æ§åˆ¶
   âœ… åŸºäºQUICï¼Œæ›´çµæ´»çš„æ‹¥å¡æ§åˆ¶ç®—æ³•

5. å†…ç½®åŠ å¯†
   âœ… é»˜è®¤TLS 1.3åŠ å¯†ï¼Œæ›´å®‰å…¨

6. æ›´å¿«çš„å‘å±•
   âœ… åŸºäºUDPï¼Œåœ¨ç”¨æˆ·ç©ºé—´å®ç°ï¼Œæ›´æ–°æ›´å¿«

é€‚ç”¨åœºæ™¯ï¼š
- ç§»åŠ¨ç½‘ç»œï¼ˆé¢‘ç¹åˆ‡æ¢ï¼‰
- å¼±ç½‘ç¯å¢ƒï¼ˆé«˜ä¸¢åŒ…ç‡ï¼‰
- å®æ—¶åº”ç”¨ï¼ˆä½å»¶è¿Ÿè¦æ±‚ï¼‰
- è§†é¢‘æµåª’ä½“
- Webåº”ç”¨

ä¸‹ä¸€èŠ‚æˆ‘ä»¬å°†å­¦ä¹ RESTful APIè®¾è®¡ï¼
    """)


if __name__ == "__main__":
    main()

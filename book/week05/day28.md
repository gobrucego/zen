# ç¬¬28å¤©ï¼šHTTP/2åè®®ç‰¹æ€§

> "HTTP/2å°±åƒä»å•è½¦é“å‡çº§åˆ°å¤šè½¦é“é«˜é€Ÿå…¬è·¯ï¼Œè®©ç½‘é¡µåŠ è½½å¿«å¦‚é—ªç”µï¼"

## ğŸ“š ä»Šæ—¥ç›®æ ‡

- ç†è§£HTTP/1.1çš„æ€§èƒ½ç“¶é¢ˆ
- æŒæ¡HTTP/2çš„æ ¸å¿ƒç‰¹æ€§
- å­¦ä¹ äºŒè¿›åˆ¶åˆ†å¸§æœºåˆ¶
- ç†è§£å¤šè·¯å¤ç”¨åŸç†
- å®ç°HTTP/2å®¢æˆ·ç«¯

---

## 1. HTTP/1.1çš„é—®é¢˜

### 1.1 æ€§èƒ½ç“¶é¢ˆ

```
HTTP/1.1å­˜åœ¨çš„ä¸»è¦é—®é¢˜ï¼š

1. é˜Ÿå¤´é˜»å¡ (Head-of-Line Blocking)
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚  è¯·æ±‚1  â†’  ç­‰å¾…å“åº”1                  â”‚
   â”‚  è¯·æ±‚2  â†’  ç­‰å¾…è¯·æ±‚1å®Œæˆæ‰èƒ½å‘é€      â”‚
   â”‚  è¯·æ±‚3  â†’  ç­‰å¾…è¯·æ±‚2å®Œæˆæ‰èƒ½å‘é€      â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

   é—®é¢˜ï¼šä¸€ä¸ªæ…¢è¯·æ±‚ä¼šé˜»å¡åé¢æ‰€æœ‰è¯·æ±‚

2. è¿æ¥æ•°é™åˆ¶
   - æµè§ˆå™¨å¯¹æ¯ä¸ªåŸŸåé™åˆ¶6-8ä¸ªå¹¶å‘è¿æ¥
   - éœ€è¦åŸŸååˆ†ç‰‡(Domain Sharding)æ¥ç»•è¿‡é™åˆ¶
   - å¢åŠ DNSæŸ¥è¯¢å’ŒTCPè¿æ¥å¼€é”€

3. å¤´éƒ¨å†—ä½™
   - æ¯ä¸ªè¯·æ±‚éƒ½è¦å‘é€å®Œæ•´çš„HTTPå¤´
   - Cookieç­‰ä¿¡æ¯é‡å¤å‘é€
   - æµªè´¹å¸¦å®½

4. æ— æ³•è®¾ç½®ä¼˜å…ˆçº§
   - æ‰€æœ‰èµ„æºå¹³ç­‰å¯¹å¾…
   - å…³é”®èµ„æºå¯èƒ½è¢«å»¶è¿ŸåŠ è½½
```

### 1.2 ç”Ÿæ´»åŒ–ç±»æ¯”

```
HTTP/1.1 = å•è½¦é“æ”¶è´¹ç«™
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  è½¦1 â†’ æ­£åœ¨æ”¶è´¹                              â”‚
â”‚  è½¦2 â†’ ç­‰å¾…è½¦1                               â”‚
â”‚  è½¦3 â†’ ç­‰å¾…è½¦2                               â”‚
â”‚  è½¦4 â†’ ç­‰å¾…è½¦3                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
é—®é¢˜ï¼šä¸€è¾†è½¦æ…¢äº†ï¼Œåé¢å…¨éƒ½æ…¢

HTTP/2 = å¤šè½¦é“æ”¶è´¹ç«™ï¼ˆETCï¼‰
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  è½¦1ã€è½¦2ã€è½¦3ã€è½¦4  â†’ åŒæ—¶é€šè¿‡              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
ä¼˜åŠ¿ï¼šæ‰€æœ‰è½¦åŒæ—¶å¿«é€Ÿé€šè¿‡
```

---

## 2. HTTP/2æ ¸å¿ƒç‰¹æ€§

### 2.1 ç‰¹æ€§æ¦‚è§ˆ

```
HTTP/2çš„äº”å¤§æ ¸å¿ƒç‰¹æ€§ï¼š

1. äºŒè¿›åˆ¶åˆ†å¸§ (Binary Framing)
   - HTTP/1.1: æ–‡æœ¬åè®®
   - HTTP/2: äºŒè¿›åˆ¶åè®®
   - æ›´é«˜æ•ˆçš„è§£æå’Œä¼ è¾“

2. å¤šè·¯å¤ç”¨ (Multiplexing)
   - å•ä¸ªTCPè¿æ¥
   - å¤šä¸ªè¯·æ±‚/å“åº”å¹¶è¡Œ
   - æ— é˜Ÿå¤´é˜»å¡

3. å¤´éƒ¨å‹ç¼© (Header Compression)
   - HPACKå‹ç¼©ç®—æ³•
   - å‡å°‘å¤´éƒ¨å¤§å°
   - ç»´æŠ¤å¤´éƒ¨å­—å…¸

4. æœåŠ¡å™¨æ¨é€ (Server Push)
   - ä¸»åŠ¨æ¨é€èµ„æº
   - æ— éœ€å®¢æˆ·ç«¯è¯·æ±‚
   - æå‰åŠ è½½å…³é”®èµ„æº

5. è¯·æ±‚ä¼˜å…ˆçº§ (Stream Priority)
   - è®¾ç½®èµ„æºä¼˜å…ˆçº§
   - å…³é”®èµ„æºä¼˜å…ˆåŠ è½½
   - ä¼˜åŒ–é¡µé¢æ¸²æŸ“
```

### 2.2 äºŒè¿›åˆ¶åˆ†å¸§å±‚

```
HTTP/2çš„åˆ†å±‚ç»“æ„ï¼š

åº”ç”¨å±‚
  â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  HTTP/2 è¯­ä¹‰å±‚                       â”‚
â”‚  (è¯·æ±‚ã€å“åº”ã€å¤´éƒ¨ã€æ•°æ®)             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
  â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  HTTP/2 åˆ†å¸§å±‚ (Binary Framing)     â”‚
â”‚  - å°†æ¶ˆæ¯åˆ†å‰²æˆå¸§                    â”‚
â”‚  - å¸§ç±»å‹ï¼šHEADERS, DATA, etc.      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
  â†“
TCP/IPåè®®æ ˆ

å¸§çš„ç»“æ„ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Length   â”‚ Type     â”‚ Flags    â”‚ Stream IDâ”‚
â”‚ (3å­—èŠ‚)  â”‚ (1å­—èŠ‚)  â”‚ (1å­—èŠ‚)  â”‚ (4å­—èŠ‚)   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚             Frame Payload                 â”‚
â”‚             (å¸§è´Ÿè½½)                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

å¸§ç±»å‹ï¼š
- DATA: ä¼ è¾“æ•°æ®
- HEADERS: ä¼ è¾“å¤´éƒ¨
- PRIORITY: è®¾ç½®ä¼˜å…ˆçº§
- RST_STREAM: ç»ˆæ­¢æµ
- SETTINGS: è®¾ç½®å‚æ•°
- PUSH_PROMISE: æœåŠ¡å™¨æ¨é€
- PING: å¿ƒè·³æ£€æµ‹
- GOAWAY: å…³é—­è¿æ¥
- WINDOW_UPDATE: æµé‡æ§åˆ¶
- CONTINUATION: å»¶ç»­å¤´éƒ¨
```

### 2.3 å¤šè·¯å¤ç”¨åŸç†

```
HTTP/1.1 vs HTTP/2 è¿æ¥æ¨¡å‹ï¼š

HTTP/1.1ï¼ˆéœ€è¦å¤šä¸ªè¿æ¥ï¼‰ï¼š
è¿æ¥1: GET /index.html  â†’  [====å“åº”====]
è¿æ¥2: GET /style.css   â†’       [====å“åº”====]
è¿æ¥3: GET /script.js   â†’            [====å“åº”====]
è¿æ¥4: GET /image.png   â†’                 [====å“åº”====]

é—®é¢˜ï¼š
- éœ€è¦å»ºç«‹å¤šä¸ªTCPè¿æ¥
- æ¯ä¸ªè¿æ¥çš„æ¡æ‰‹å¼€é”€
- è¿æ¥æ•°å—é™åˆ¶

HTTP/2ï¼ˆå•ä¸ªè¿æ¥ï¼Œå¤šä¸ªæµï¼‰ï¼š
å•ä¸ªTCPè¿æ¥:
  æµ1: GET /index.html  â†’  [==å“åº”==]
  æµ3: GET /style.css   â†’    [==å“åº”==]
  æµ5: GET /script.js   â†’  [==å“åº”==]
  æµ7: GET /image.png   â†’      [==å“åº”==]

ä¼˜åŠ¿ï¼š
- åªéœ€ä¸€ä¸ªTCPè¿æ¥
- å‡å°‘è¿æ¥å¼€é”€
- å¹¶è¡Œä¼ è¾“å¤šä¸ªèµ„æº
- é¿å…é˜Ÿå¤´é˜»å¡

æµçš„æ¦‚å¿µï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  å•ä¸ªHTTP/2è¿æ¥                          â”‚
â”‚  â”œâ”€ æµ1 (Stream 1)                      â”‚
â”‚  â”‚   â”œâ”€ HEADERS å¸§                      â”‚
â”‚  â”‚   â”œâ”€ DATA å¸§ 1                       â”‚
â”‚  â”‚   â””â”€ DATA å¸§ 2                       â”‚
â”‚  â”œâ”€ æµ3 (Stream 3)                      â”‚
â”‚  â”‚   â”œâ”€ HEADERS å¸§                      â”‚
â”‚  â”‚   â””â”€ DATA å¸§                         â”‚
â”‚  â””â”€ æµ5 (Stream 5)                      â”‚
â”‚      â””â”€ HEADERS å¸§                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

æµçš„ç”Ÿå‘½å‘¨æœŸï¼š
idle â†’ open â†’ half-closed â†’ closed
```

### 2.4 å¤´éƒ¨å‹ç¼©ï¼ˆHPACKï¼‰

```
HPACKå‹ç¼©åŸç†ï¼š

1. é™æ€è¡¨ï¼ˆé¢„å®šä¹‰çš„å¸¸ç”¨å¤´éƒ¨ï¼‰
â”Œâ”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ç´¢å¼•â”‚  å¤´éƒ¨åç§°        â”‚  å€¼              â”‚
â”œâ”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  1  â”‚ :authority       â”‚                 â”‚
â”‚  2  â”‚ :method          â”‚ GET             â”‚
â”‚  3  â”‚ :method          â”‚ POST            â”‚
â”‚  4  â”‚ :path            â”‚ /               â”‚
â”‚  5  â”‚ :path            â”‚ /index.html     â”‚
â”‚  6  â”‚ :scheme          â”‚ http            â”‚
â”‚  7  â”‚ :scheme          â”‚ https           â”‚
â”‚  8  â”‚ :status          â”‚ 200             â”‚
â”‚ ... â”‚ ...              â”‚ ...             â”‚
â””â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

2. åŠ¨æ€è¡¨ï¼ˆè¿æ¥æœŸé—´å»ºç«‹çš„è¡¨ï¼‰
   - è®°å½•å·²å‘é€çš„å¤´éƒ¨
   - åç»­åªå‘é€ç´¢å¼•
   - å¤§å¹…å‡å°‘é‡å¤æ•°æ®

ç¤ºä¾‹ï¼š
ç¬¬ä¸€ä¸ªè¯·æ±‚ï¼š
:method: GET
:path: /index.html
:scheme: https
user-agent: Mozilla/5.0...
cookie: session=abc123...

ç¬¬äºŒä¸ªè¯·æ±‚ï¼ˆå‹ç¼©åï¼‰ï¼š
:method: GET          â†’ ç´¢å¼•2ï¼ˆä»é™æ€è¡¨ï¼‰
:path: /style.css     â†’ æ–°å€¼
:scheme: https        â†’ ç´¢å¼•7ï¼ˆä»é™æ€è¡¨ï¼‰
user-agent: ...       â†’ ç´¢å¼•62ï¼ˆä»åŠ¨æ€è¡¨ï¼‰
cookie: ...           â†’ ç´¢å¼•63ï¼ˆä»åŠ¨æ€è¡¨ï¼‰

å‹ç¼©æ•ˆæœï¼š
- é¦–æ¬¡è¯·æ±‚ï¼š500å­—èŠ‚
- åç»­è¯·æ±‚ï¼š50å­—èŠ‚
- å‹ç¼©ç‡ï¼š90%
```

### 2.5 æœåŠ¡å™¨æ¨é€

```
æœåŠ¡å™¨æ¨é€æµç¨‹ï¼š

ä¼ ç»ŸHTTP/1.1ï¼š
å®¢æˆ·ç«¯: GET /index.html
æœåŠ¡å™¨: â†’ è¿”å›index.html
å®¢æˆ·ç«¯: (è§£æHTMLï¼Œå‘ç°éœ€è¦style.css)
å®¢æˆ·ç«¯: GET /style.css
æœåŠ¡å™¨: â†’ è¿”å›style.css
å®¢æˆ·ç«¯: (è§£æHTMLï¼Œå‘ç°éœ€è¦script.js)
å®¢æˆ·ç«¯: GET /script.js
æœåŠ¡å™¨: â†’ è¿”å›script.js

æ€»å¾€è¿”æ¬¡æ•°ï¼š6æ¬¡ï¼ˆ3ä¸ªè¯·æ±‚-å“åº”ï¼‰

HTTP/2æœåŠ¡å™¨æ¨é€ï¼š
å®¢æˆ·ç«¯: GET /index.html
æœåŠ¡å™¨: â†’ PUSH_PROMISE /style.css
æœåŠ¡å™¨: â†’ PUSH_PROMISE /script.js
æœåŠ¡å™¨: â†’ è¿”å›index.html
æœåŠ¡å™¨: â†’ è¿”å›style.css (æ¨é€)
æœåŠ¡å™¨: â†’ è¿”å›script.js (æ¨é€)

æ€»å¾€è¿”æ¬¡æ•°ï¼š2æ¬¡ï¼ˆ1ä¸ªè¯·æ±‚ï¼ŒæœåŠ¡å™¨ä¸»åŠ¨æ¨é€å…¶ä»–èµ„æºï¼‰

æ¨é€ç¤ºä¾‹ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  å®¢æˆ·ç«¯è¯·æ±‚                             â”‚
â”‚  GET /index.html HTTP/2                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  æœåŠ¡å™¨å“åº”                             â”‚
â”‚  1. PUSH_PROMISE                       â”‚
â”‚     :method: GET                       â”‚
â”‚     :path: /style.css                  â”‚
â”‚                                        â”‚
â”‚  2. HEADERS (index.htmlçš„å“åº”å¤´)       â”‚
â”‚  3. DATA (index.htmlçš„å†…å®¹)            â”‚
â”‚                                        â”‚
â”‚  4. HEADERS (style.cssçš„å“åº”å¤´)        â”‚
â”‚  5. DATA (style.cssçš„å†…å®¹ - æ¨é€)      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 3. å®æˆ˜é¡¹ç›®ï¼šHTTP/2å®¢æˆ·ç«¯åˆ†æå™¨

### 3.1 é¡¹ç›®éœ€æ±‚

```
åŠŸèƒ½ï¼š
1. å‘é€HTTP/2è¯·æ±‚
2. åˆ†æHTTP/2å¸§ç»“æ„
3. å¯¹æ¯”HTTP/1.1å’ŒHTTP/2æ€§èƒ½
4. å±•ç¤ºå¤šè·¯å¤ç”¨æ•ˆæœ
```

### 3.2 ä»£ç å®ç°

```python
# day28_http2_analyzer.py
# åŠŸèƒ½ï¼šHTTP/2åè®®åˆ†æå™¨

import ssl
import socket
from typing import Dict, List, Tuple
import time

# æ³¨æ„ï¼šéœ€è¦å®‰è£… hyper åº“æ¥å¤„ç†HTTP/2
# pip install hyper

try:
    from hyper import HTTPConnection
    from hyper.common.headers import HTTPHeaderMap
except ImportError:
    print("è¯·å…ˆå®‰è£…hyperåº“: pip install hyper")
    exit(1)


class HTTP2Analyzer:
    """
    HTTP/2åè®®åˆ†æå™¨

    åŠŸèƒ½ï¼š
        1. å‘é€HTTP/2è¯·æ±‚
        2. åˆ†æå“åº”æ€§èƒ½
        3. å¯¹æ¯”HTTP/1.1å’ŒHTTP/2
        4. æ¼”ç¤ºå¤šè·¯å¤ç”¨
    """

    def __init__(self, host: str, port: int = 443):
        """
        åˆå§‹åŒ–HTTP/2è¿æ¥

        å‚æ•°ï¼š
            host: ç›®æ ‡ä¸»æœº
            port: ç«¯å£ï¼ˆé»˜è®¤443 for HTTPSï¼‰
        """
        self.host = host
        self.port = port
        self.conn = None

    def connect(self):
        """
        å»ºç«‹HTTP/2è¿æ¥

        å·¥ä½œåŸç†ï¼š
            1. åˆ›å»ºSSL/TLSè¿æ¥
            2. é€šè¿‡ALPNåå•†HTTP/2
            3. å»ºç«‹HTTP/2è¿æ¥
        """
        try:
            print(f"\næ­£åœ¨è¿æ¥åˆ° {self.host}:{self.port}...")
            self.conn = HTTPConnection(self.host, self.port)
            print("âœ… HTTP/2è¿æ¥å»ºç«‹æˆåŠŸ")
            return True
        except Exception as e:
            print(f"âŒ è¿æ¥å¤±è´¥: {e}")
            return False

    def request_single(self, path: str = '/') -> Tuple[float, int]:
        """
        å‘é€å•ä¸ªHTTP/2è¯·æ±‚

        å‚æ•°ï¼š
            path: è¯·æ±‚è·¯å¾„

        è¿”å›å€¼ï¼š
            (å“åº”æ—¶é—´, å“åº”å¤§å°)
        """
        try:
            start_time = time.time()

            # å‘é€GETè¯·æ±‚
            stream_id = self.conn.request('GET', path)

            # è·å–å“åº”
            response = self.conn.get_response(stream_id)

            # è¯»å–å“åº”ä½“
            body = response.read()

            end_time = time.time()
            elapsed = (end_time - start_time) * 1000  # è½¬æ¢ä¸ºæ¯«ç§’

            print(f"  {path}")
            print(f"    çŠ¶æ€ç : {response.status}")
            print(f"    å“åº”æ—¶é—´: {elapsed:.2f}ms")
            print(f"    å“åº”å¤§å°: {len(body)} bytes")

            return elapsed, len(body)

        except Exception as e:
            print(f"  âŒ è¯·æ±‚å¤±è´¥: {e}")
            return 0, 0

    def request_multiple(self, paths: List[str]) -> Dict[str, Tuple[float, int]]:
        """
        å¹¶å‘å‘é€å¤šä¸ªHTTP/2è¯·æ±‚ï¼ˆæ¼”ç¤ºå¤šè·¯å¤ç”¨ï¼‰

        å‚æ•°ï¼š
            paths: è·¯å¾„åˆ—è¡¨

        è¿”å›å€¼ï¼š
            {è·¯å¾„: (å“åº”æ—¶é—´, å“åº”å¤§å°)}

        å·¥ä½œåŸç†ï¼š
            HTTP/2å…è®¸åœ¨å•ä¸ªè¿æ¥ä¸Šå¹¶å‘å¤šä¸ªè¯·æ±‚
            ä¸éœ€è¦ç­‰å¾…å‰ä¸€ä¸ªè¯·æ±‚å®Œæˆ
        """
        results = {}
        stream_ids = {}

        print(f"\næ­£åœ¨å¹¶å‘è¯·æ±‚ {len(paths)} ä¸ªèµ„æº...")

        # ç¬¬ä¸€æ­¥ï¼šå‘é€æ‰€æœ‰è¯·æ±‚ï¼ˆä¸ç­‰å¾…å“åº”ï¼‰
        start_time = time.time()

        for path in paths:
            try:
                stream_id = self.conn.request('GET', path)
                stream_ids[stream_id] = path
                print(f"  å‘é€è¯·æ±‚: {path} (æµID: {stream_id})")
            except Exception as e:
                print(f"  âŒ å‘é€è¯·æ±‚å¤±è´¥ {path}: {e}")

        # ç¬¬äºŒæ­¥ï¼šæ¥æ”¶æ‰€æœ‰å“åº”
        for stream_id, path in stream_ids.items():
            try:
                response = self.conn.get_response(stream_id)
                body = response.read()

                elapsed = (time.time() - start_time) * 1000
                results[path] = (elapsed, len(body))

                print(f"  æ¥æ”¶å“åº”: {path}")
                print(f"    çŠ¶æ€ç : {response.status}")
                print(f"    å¤§å°: {len(body)} bytes")

            except Exception as e:
                print(f"  âŒ æ¥æ”¶å“åº”å¤±è´¥ {path}: {e}")
                results[path] = (0, 0)

        total_time = (time.time() - start_time) * 1000
        print(f"\næ€»è€—æ—¶: {total_time:.2f}ms")

        return results

    def analyze_headers(self):
        """
        åˆ†æHTTP/2å¤´éƒ¨å‹ç¼©æ•ˆæœ

        æ¼”ç¤ºï¼š
            å‘é€å¤šä¸ªè¯·æ±‚ï¼Œè§‚å¯Ÿå¤´éƒ¨å‹ç¼©å¸¦æ¥çš„æ€§èƒ½æå‡
        """
        print("\n" + "="*60)
        print(" HTTP/2å¤´éƒ¨å‹ç¼©åˆ†æ")
        print("="*60)

        paths = ['/', '/about', '/contact']

        for i, path in enumerate(paths, 1):
            print(f"\nè¯·æ±‚ {i}: {path}")
            self.request_single(path)

        print("""
å¤´éƒ¨å‹ç¼©è¯´æ˜ï¼š
- ç¬¬ä¸€ä¸ªè¯·æ±‚å‘é€å®Œæ•´å¤´éƒ¨
- åç»­è¯·æ±‚åªå‘é€å¤´éƒ¨ç´¢å¼•
- HPACKç®—æ³•å‹ç¼©ç‡å¯è¾¾90%
        """)

    def compare_http_versions(self):
        """
        å¯¹æ¯”HTTP/1.1å’ŒHTTP/2æ€§èƒ½

        è¯´æ˜ï¼š
            è¿™æ˜¯ä¸€ä¸ªç®€åŒ–çš„å¯¹æ¯”æ¼”ç¤º
            å®é™…æ€§èƒ½å·®å¼‚éœ€è¦çœŸå®ç¯å¢ƒæµ‹è¯•
        """
        print("\n" + "="*60)
        print(" HTTP/1.1 vs HTTP/2 æ€§èƒ½å¯¹æ¯”")
        print("="*60)

        print("""
å‡è®¾åœºæ™¯ï¼šåŠ è½½ä¸€ä¸ªç½‘é¡µï¼ŒåŒ…å«ï¼š
- 1ä¸ªHTMLæ–‡ä»¶
- 3ä¸ªCSSæ–‡ä»¶
- 5ä¸ªJSæ–‡ä»¶
- 10ä¸ªå›¾ç‰‡æ–‡ä»¶
å…±19ä¸ªèµ„æº

HTTP/1.1ï¼ˆ6ä¸ªå¹¶å‘è¿æ¥ï¼‰ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ è¿æ¥1: [HTML]                          â”‚
â”‚ è¿æ¥2: [CSS1][CSS2][CSS3]              â”‚
â”‚ è¿æ¥3: [JS1][JS2]                      â”‚
â”‚ è¿æ¥4: [JS3][JS4][JS5]                 â”‚
â”‚ è¿æ¥5: [IMG1][IMG2][IMG3][IMG4]        â”‚
â”‚ è¿æ¥6: [IMG5][IMG6][IMG7][IMG8]        â”‚
â”‚ ç­‰å¾…é˜Ÿåˆ—: [IMG9][IMG10]                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
æ€»è€—æ—¶ï¼šçº¦800msï¼ˆä¼°ç®—ï¼‰
- 6ä¸ªTCPè¿æ¥å»ºç«‹ï¼š6 Ã— 100ms = 600ms
- èµ„æºä¸‹è½½ï¼š200ms

HTTP/2ï¼ˆå•ä¸ªè¿æ¥ï¼Œå¤šè·¯å¤ç”¨ï¼‰ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ å•ä¸ªè¿æ¥:                               â”‚
â”‚ [HTML][CSS1][CSS2][CSS3][JS1][JS2]...  â”‚
â”‚ æ‰€æœ‰19ä¸ªèµ„æºå¹¶è¡Œä¼ è¾“                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
æ€»è€—æ—¶ï¼šçº¦150msï¼ˆä¼°ç®—ï¼‰
- 1ä¸ªTCPè¿æ¥å»ºç«‹ï¼š100ms
- èµ„æºä¸‹è½½ï¼ˆå¹¶è¡Œï¼‰ï¼š50ms

æ€§èƒ½æå‡ï¼š(800-150)/800 = 81.25%
        """)

    def demonstrate_multiplexing(self):
        """
        æ¼”ç¤ºå¤šè·¯å¤ç”¨

        å·¥ä½œåŸç†ï¼š
            åœ¨å•ä¸ªTCPè¿æ¥ä¸Šï¼ŒåŒæ—¶å‘é€å¤šä¸ªè¯·æ±‚
            ä¸éœ€è¦ç­‰å¾…å‰ä¸€ä¸ªè¯·æ±‚å®Œæˆ
        """
        print("\n" + "="*60)
        print(" å¤šè·¯å¤ç”¨æ¼”ç¤º")
        print("="*60)

        # æ¨¡æ‹Ÿè¯·æ±‚å¤šä¸ªèµ„æº
        paths = [
            '/',
            '/favicon.ico',
            '/robots.txt'
        ]

        print("\næ–¹å¼1ï¼šé¡ºåºè¯·æ±‚ï¼ˆæ¨¡æ‹ŸHTTP/1.1ï¼‰")
        print("-" * 60)
        total_sequential = 0
        for path in paths:
            elapsed, size = self.request_single(path)
            total_sequential += elapsed
        print(f"\né¡ºåºè¯·æ±‚æ€»è€—æ—¶: {total_sequential:.2f}ms")

        # é‡æ–°è¿æ¥
        self.connect()

        print("\næ–¹å¼2ï¼šå¹¶å‘è¯·æ±‚ï¼ˆHTTP/2å¤šè·¯å¤ç”¨ï¼‰")
        print("-" * 60)
        results = self.request_multiple(paths)

        print(f"""
å¯¹æ¯”ç»“æœï¼š
- é¡ºåºè¯·æ±‚: {total_sequential:.2f}ms
- å¹¶å‘è¯·æ±‚: {max(r[0] for r in results.values()):.2f}ms
- æ€§èƒ½æå‡: {(1 - max(r[0] for r in results.values())/total_sequential)*100:.1f}%

è¯´æ˜ï¼šHTTP/2å¤šè·¯å¤ç”¨å…è®¸å¤šä¸ªè¯·æ±‚/å“åº”å¹¶è¡Œä¼ è¾“
      é¿å…äº†é˜Ÿå¤´é˜»å¡ï¼Œæ˜¾è‘—æå‡æ€§èƒ½
        """)

    def close(self):
        """å…³é—­è¿æ¥"""
        if self.conn:
            self.conn.close()
            print("\nè¿æ¥å·²å…³é—­")


class SimpleHTTP2Demo:
    """
    ç®€åŒ–çš„HTTP/2æ¦‚å¿µæ¼”ç¤º
    ï¼ˆä¸ä¾èµ–å¤–éƒ¨åº“ï¼Œçº¯Pythonå®ç°æ¦‚å¿µæ¼”ç¤ºï¼‰
    """

    @staticmethod
    def show_frame_structure():
        """
        å±•ç¤ºHTTP/2å¸§ç»“æ„
        """
        print("\n" + "="*60)
        print(" HTTP/2å¸§ç»“æ„æ¼”ç¤º")
        print("="*60)

        print("""
HTTP/2å¸§æ ¼å¼ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  +-----------------------------------------------+   â”‚
â”‚  |                 Length (24)                   |   â”‚
â”‚  +---------------+---------------+---------------+   â”‚
â”‚  |   Type (8)    |   Flags (8)   |                   â”‚
â”‚  +-+-------------+---------------+------...------+   â”‚
â”‚  |R|                 Stream ID (31)               |   â”‚
â”‚  +=+===========================================+   â”‚
â”‚  |                   Frame Payload               |   â”‚
â”‚  +-----------------------------------------------+   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

å­—æ®µè¯´æ˜ï¼š
- Length: 24ä½ï¼Œå¸§è´Ÿè½½çš„é•¿åº¦
- Type: 8ä½ï¼Œå¸§ç±»å‹
  * 0x0: DATA
  * 0x1: HEADERS
  * 0x2: PRIORITY
  * 0x3: RST_STREAM
  * 0x4: SETTINGS
  * 0x5: PUSH_PROMISE
  * 0x6: PING
  * 0x7: GOAWAY
  * 0x8: WINDOW_UPDATE
  * 0x9: CONTINUATION
- Flags: 8ä½ï¼Œç‰¹å®šäºå¸§ç±»å‹çš„æ ‡å¿—
- R: 1ä½ï¼Œä¿ç•™ä½
- Stream ID: 31ä½ï¼Œæµæ ‡è¯†ç¬¦

ç¤ºä¾‹å¸§ï¼ˆHEADERSå¸§ï¼‰ï¼š
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Length: 0x000012 (18å­—èŠ‚)            â”‚
â”‚ Type: 0x01 (HEADERS)                 â”‚
â”‚ Flags: 0x04 (END_HEADERS)            â”‚
â”‚ Stream ID: 0x00000001                â”‚
â”‚ Payload: (å‹ç¼©çš„å¤´éƒ¨æ•°æ®)            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        """)

    @staticmethod
    def show_stream_states():
        """
        å±•ç¤ºæµçŠ¶æ€è½¬æ¢
        """
        print("\n" + "="*60)
        print(" HTTP/2æµçŠ¶æ€è½¬æ¢")
        print("="*60)

        print("""
æµçš„ç”Ÿå‘½å‘¨æœŸï¼š

                        +--------+
                        | idle   |  åˆå§‹çŠ¶æ€
                        +--------+
                             |
                             | å‘é€/æ¥æ”¶ HEADERS
                             |
                             v
                        +--------+
                        | open   |  æ‰“å¼€çŠ¶æ€ï¼ˆåŒå‘é€šä¿¡ï¼‰
                        +--------+
                             |
                â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                |                         |
                | å‘é€ END_STREAM         | æ¥æ”¶ END_STREAM
                v                         v
          +-------------+           +-------------+
          | half-closed |           | half-closed |
          | (local)     |           | (remote)    |
          +-------------+           +-------------+
                |                         |
                | æ¥æ”¶ END_STREAM         | å‘é€ END_STREAM
                â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             v
                        +--------+
                        | closed |  å…³é—­çŠ¶æ€
                        +--------+

çŠ¶æ€è¯´æ˜ï¼š
- idle: æœªä½¿ç”¨çš„æµ
- open: æ´»è·ƒçš„æµï¼Œå¯ä»¥åŒå‘å‘é€å¸§
- half-closed: ä¸€ç«¯å·²å…³é—­ï¼Œåªèƒ½å•å‘é€šä¿¡
- closed: æµå·²å…³é—­ï¼Œä¸èƒ½å†å‘é€å¸§
        """)

    @staticmethod
    def show_hpack_example():
        """
        å±•ç¤ºHPACKå‹ç¼©ç¤ºä¾‹
        """
        print("\n" + "="*60)
        print(" HPACKå¤´éƒ¨å‹ç¼©ç¤ºä¾‹")
        print("="*60)

        print("""
åœºæ™¯ï¼šå‘é€ä¸¤ä¸ªç›¸ä¼¼çš„HTTPè¯·æ±‚

è¯·æ±‚1ï¼ˆæœªå‹ç¼©ï¼‰ï¼š
:method: GET
:scheme: https
:path: /index.html
:authority: www.example.com
user-agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64)
accept: text/html,application/xhtml+xml
accept-language: zh-CN,zh;q=0.9
accept-encoding: gzip, deflate, br
cookie: session_id=abc123; user_id=456

åŸå§‹å¤§å°ï¼šçº¦ 280 å­—èŠ‚

è¯·æ±‚1ï¼ˆHPACKå‹ç¼©åï¼‰ï¼š
ä½¿ç”¨ç´¢å¼•ç¼–ç ï¼š
  :method: GET       â†’ 2 (é™æ€è¡¨ç´¢å¼•)
  :scheme: https     â†’ 7 (é™æ€è¡¨ç´¢å¼•)
  :path: /index.html â†’ åŠ¨æ€ç¼–ç 
  :authority: ...    â†’ åŠ¨æ€ç¼–ç 
  user-agent: ...    â†’ åŠ¨æ€ç¼–ç å¹¶åŠ å…¥åŠ¨æ€è¡¨
  accept: ...        â†’ åŠ¨æ€ç¼–ç å¹¶åŠ å…¥åŠ¨æ€è¡¨
  å…¶ä»–å¤´éƒ¨...        â†’ åŠ¨æ€ç¼–ç å¹¶åŠ å…¥åŠ¨æ€è¡¨

å‹ç¼©åå¤§å°ï¼šçº¦ 150 å­—èŠ‚
å‹ç¼©ç‡ï¼š46%

---

è¯·æ±‚2ï¼ˆåˆ©ç”¨åŠ¨æ€è¡¨ï¼‰ï¼š
:method: GET           â†’ 2 (é™æ€è¡¨)
:scheme: https         â†’ 7 (é™æ€è¡¨)
:path: /style.css      â†’ åŠ¨æ€ç¼–ç ï¼ˆåªæœ‰è·¯å¾„ä¸åŒï¼‰
:authority: ...        â†’ 62 (åŠ¨æ€è¡¨ç´¢å¼•)
user-agent: ...        â†’ 63 (åŠ¨æ€è¡¨ç´¢å¼•)
accept: ...            â†’ 64 (åŠ¨æ€è¡¨ç´¢å¼•)
accept-language: ...   â†’ 65 (åŠ¨æ€è¡¨ç´¢å¼•)
accept-encoding: ...   â†’ 66 (åŠ¨æ€è¡¨ç´¢å¼•)
cookie: ...            â†’ 67 (åŠ¨æ€è¡¨ç´¢å¼•)

å‹ç¼©åå¤§å°ï¼šçº¦ 30 å­—èŠ‚
å‹ç¼©ç‡ï¼š89%

åŠ¨æ€è¡¨å†…å®¹ï¼š
â”Œâ”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ç´¢å¼•â”‚  åç§°            â”‚  å€¼                  â”‚
â”œâ”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚62 â”‚ :authority       â”‚ www.example.com     â”‚
â”‚63 â”‚ user-agent       â”‚ Mozilla/5.0...      â”‚
â”‚64 â”‚ accept           â”‚ text/html,...       â”‚
â”‚65 â”‚ accept-language  â”‚ zh-CN,zh;q=0.9      â”‚
â”‚66 â”‚ accept-encoding  â”‚ gzip, deflate, br   â”‚
â”‚67 â”‚ cookie           â”‚ session_id=abc123...â”‚
â””â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

æ€»ç»“ï¼š
- ç¬¬ä¸€ä¸ªè¯·æ±‚å»ºç«‹åŠ¨æ€è¡¨
- åç»­è¯·æ±‚å¤ç”¨åŠ¨æ€è¡¨
- å‹ç¼©ç‡éšç€è¯·æ±‚å¢åŠ è€Œæé«˜
        """)


def main():
    """ä¸»ç¨‹åº"""
    print("""
    â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
    â•‘       HTTP/2åè®®åˆ†æå™¨ v1.0                               â•‘
    â•‘       HTTP/2 Protocol Analyzer                           â•‘
    â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    """)

    # é¦–å…ˆå±•ç¤ºæ¦‚å¿µæ¼”ç¤ºï¼ˆä¸éœ€è¦ç½‘ç»œè¿æ¥ï¼‰
    demo = SimpleHTTP2Demo()

    print("\nã€ç¬¬ä¸€éƒ¨åˆ†ï¼šHTTP/2åŸºç¡€æ¦‚å¿µã€‘")
    demo.show_frame_structure()
    input("\næŒ‰Enterç»§ç»­...")

    demo.show_stream_states()
    input("\næŒ‰Enterç»§ç»­...")

    demo.show_hpack_example()
    input("\næŒ‰Enterç»§ç»­...")

    # å®é™…HTTP/2è¿æ¥æ¼”ç¤ºï¼ˆéœ€è¦ç½‘ç»œï¼‰
    print("\nã€ç¬¬äºŒéƒ¨åˆ†ï¼šHTTP/2å®é™…è¿æ¥æ¼”ç¤ºã€‘")

    choice = input("\næ˜¯å¦è¿›è¡Œå®é™…HTTP/2è¿æ¥æµ‹è¯•ï¼Ÿ(y/n): ").strip().lower()

    if choice == 'y':
        # ä½¿ç”¨æ”¯æŒHTTP/2çš„ç½‘ç«™è¿›è¡Œæµ‹è¯•
        host = input("è¯·è¾“å…¥æµ‹è¯•ç½‘ç«™ï¼ˆé»˜è®¤ï¼šwww.google.comï¼‰: ").strip()
        if not host:
            host = "www.google.com"

        analyzer = HTTP2Analyzer(host)

        if analyzer.connect():
            try:
                # å•ä¸ªè¯·æ±‚
                print("\n1. å•ä¸ªè¯·æ±‚æµ‹è¯•")
                analyzer.request_single('/')

                input("\næŒ‰Enterç»§ç»­...")

                # å¤šè·¯å¤ç”¨æ¼”ç¤º
                print("\n2. å¤šè·¯å¤ç”¨æ¼”ç¤º")
                analyzer.demonstrate_multiplexing()

                input("\næŒ‰Enterç»§ç»­...")

                # æ€§èƒ½å¯¹æ¯”
                print("\n3. æ€§èƒ½å¯¹æ¯”")
                analyzer.compare_http_versions()

            except Exception as e:
                print(f"\næµ‹è¯•è¿‡ç¨‹å‡ºé”™: {e}")
            finally:
                analyzer.close()
    else:
        print("\nè·³è¿‡å®é™…è¿æ¥æµ‹è¯•")

    print("""
    \næ€»ç»“ï¼š
    HTTP/2é€šè¿‡ä»¥ä¸‹æŠ€æœ¯æ˜¾è‘—æå‡äº†Webæ€§èƒ½ï¼š
    1. äºŒè¿›åˆ¶åˆ†å¸§ - æ›´é«˜æ•ˆçš„ä¼ è¾“
    2. å¤šè·¯å¤ç”¨ - æ¶ˆé™¤é˜Ÿå¤´é˜»å¡
    3. å¤´éƒ¨å‹ç¼© - å‡å°‘å¸¦å®½æ¶ˆè€—
    4. æœåŠ¡å™¨æ¨é€ - ä¸»åŠ¨æ¨é€èµ„æº
    5. è¯·æ±‚ä¼˜å…ˆçº§ - ä¼˜åŒ–åŠ è½½é¡ºåº

    ä¸‹ä¸€èŠ‚æˆ‘ä»¬å°†å­¦ä¹ HTTP/3å’ŒQUICåè®®ï¼
    """)


if __name__ == "__main__":
    main()
